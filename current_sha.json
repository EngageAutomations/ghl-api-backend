{
  "name": "index.js",
  "path": "index.js",
  "sha": "fe6466940b2e38c3ac8f7b83bf3a1131b3508beb",
  "size": 44462,
  "url": "https://api.github.com/repos/EngageAutomations/oauth-backend/contents/index.js?ref=main",
  "html_url": "https://github.com/EngageAutomations/oauth-backend/blob/main/index.js",
  "git_url": "https://api.github.com/repos/EngageAutomations/oauth-backend/git/blobs/fe6466940b2e38c3ac8f7b83bf3a1131b3508beb",
  "download_url": "https://raw.githubusercontent.com/EngageAutomations/oauth-backend/main/index.js",
  "type": "file",
  "content": "Ly8gT0F1dGggQmFja2VuZCBGaXggLSBBZGQgbWlzc2luZyBlbmRwb2ludHMg\nZm9yIGluc3RhbGxhdGlvbiB0cmFja2luZwovLyBUaGlzIGZpbGUgYWRkcyB0\naGUgbWlzc2luZyAvaW5zdGFsbGF0aW9ucyBlbmRwb2ludCBhbmQgZGVidWdn\naW5nCgpjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpOwpjb25z\ndCBjb3JzID0gcmVxdWlyZSgnY29ycycpOwpjb25zdCBheGlvcyA9IHJlcXVp\ncmUoJ2F4aW9zJyk7CmNvbnN0IG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicp\nOwpjb25zdCBGb3JtRGF0YSA9IHJlcXVpcmUoJ2Zvcm0tZGF0YScpOwpjb25z\ndCBmcyA9IHJlcXVpcmUoJ2ZzJyk7CgovLyBDb25maWd1cmUgbXVsdGVyIGZv\nciBmaWxlIHVwbG9hZHMKY29uc3QgdXBsb2FkID0gbXVsdGVyKHsgCiAgZGVz\ndDogJ3VwbG9hZHMvJywKICBsaW1pdHM6IHsgZmlsZVNpemU6IDI1ICogMTAy\nNCAqIDEwMjQgfSAvLyAyNU1CIGxpbWl0Cn0pOwoKY29uc3QgYXBwID0gZXhw\ncmVzcygpOwpjb25zdCBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB8fCAzMDAw\nOwoKLy8gTWlkZGxld2FyZQphcHAudXNlKGNvcnMoKSk7CmFwcC51c2UoZXhw\ncmVzcy5qc29uKCkpOwoKLy8gSW4tbWVtb3J5IGluc3RhbGwgc3RvcmUKY29u\nc3QgaW5zdGFsbGF0aW9ucyA9IG5ldyBNYXAoKTsKCi8vIEN1c3RvbWVyIHN1\ncHBvcnQgZGF0YSBzdG9yZQpjb25zdCBzdXBwb3J0VGlja2V0cyA9IG5ldyBN\nYXAoKTsKY29uc3Qgc3VwcG9ydFNlc3Npb25zID0gbmV3IE1hcCgpOwpjb25z\ndCBzdXBwb3J0TWV0cmljcyA9IHsKICB0b3RhbFRpY2tldHM6IDAsCiAgcmVz\nb2x2ZWRUaWNrZXRzOiAwLAogIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IDAsCiAg\nY3VzdG9tZXJTYXRpc2ZhY3Rpb246IDAKfTsKCi8vIEFkZCBwcmUtc2VlZGVk\nIGluc3RhbGxhdGlvbiBpZiBlbnYgdmFycyBleGlzdAppZiAocHJvY2Vzcy5l\nbnYuR0hMX0FDQ0VTU19UT0tFTikgewogIGluc3RhbGxhdGlvbnMuc2V0KCdp\nbnN0YWxsX3NlZWQnLCB7CiAgICBpZDogJ2luc3RhbGxfc2VlZCcsCiAgICBh\nY2Nlc3NUb2tlbjogcHJvY2Vzcy5lbnYuR0hMX0FDQ0VTU19UT0tFTiwKICAg\nIHJlZnJlc2hUb2tlbjogcHJvY2Vzcy5lbnYuR0hMX1JFRlJFU0hfVE9LRU4g\nfHwgbnVsbCwKICAgIGV4cGlyZXNJbjogODYzOTksCiAgICBleHBpcmVzQXQ6\nIERhdGUubm93KCkgKyA4NjM5OSAqIDEwMDAsCiAgICBsb2NhdGlvbklkOiBw\ncm9jZXNzLmVudi5HSExfTE9DQVRJT05fSUQgfHwgJ1dBdms4N1JtVzlyQlNE\nSkhlT3BIJywKICAgIHNjb3BlczogcHJvY2Vzcy5lbnYuR0hMX1NDT1BFUyB8\nfCAnbWVkaWFzLndyaXRlIG1lZGlhcy5yZWFkb25seScsCiAgICB0b2tlblN0\nYXR1czogJ3ZhbGlkJywKICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lT\nT1N0cmluZygpCiAgfSk7Cn0KCi8vIFRPS0VOIExJRkVDWUNMRSBIRUxQRVJT\nCmNvbnN0IFBBRERJTkdfTVMgPSA1ICogNjAgKiAxMDAwOwpjb25zdCByZWZy\nZXNoZXJzID0gbmV3IE1hcCgpOwoKYXN5bmMgZnVuY3Rpb24gcmVmcmVzaEFj\nY2Vzc1Rva2VuKGlkKSB7CiAgY29uc3QgaW5zdCA9IGluc3RhbGxhdGlvbnMu\nZ2V0KGlkKTsKICBpZiAoIWluc3QgfHwgIWluc3QucmVmcmVzaFRva2VuKSBy\nZXR1cm47CgogIHRyeSB7CiAgICBjb25zdCBib2R5ID0gbmV3IFVSTFNlYXJj\naFBhcmFtcyh7CiAgICAgIGNsaWVudF9pZDogcHJvY2Vzcy5lbnYuR0hMX0NM\nSUVOVF9JRCwKICAgICAgY2xpZW50X3NlY3JldDogcHJvY2Vzcy5lbnYuR0hM\nX0NMSUVOVF9TRUNSRVQsCiAgICAgIGdyYW50X3R5cGU6ICdyZWZyZXNoX3Rv\na2VuJywKICAgICAgcmVmcmVzaF90b2tlbjogaW5zdC5yZWZyZXNoVG9rZW4K\nICAgIH0pOwoKICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgYXhpb3MucG9z\ndCgKICAgICAgJ2h0dHBzOi8vc2VydmljZXMubGVhZGNvbm5lY3RvcmhxLmNv\nbS9vYXV0aC90b2tlbicsCiAgICAgIGJvZHksCiAgICAgIHsgaGVhZGVyczog\neyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJs\nZW5jb2RlZCcgfSwgdGltZW91dDogMTUwMDAgfQogICAgKTsKCiAgICBpbnN0\nLmFjY2Vzc1Rva2VuID0gZGF0YS5hY2Nlc3NfdG9rZW47CiAgICBpbnN0LnJl\nZnJlc2hUb2tlbiA9IGRhdGEucmVmcmVzaF90b2tlbiB8fCBpbnN0LnJlZnJl\nc2hUb2tlbjsKICAgIGluc3QuZXhwaXJlc0luID0gZGF0YS5leHBpcmVzX2lu\nOwogICAgaW5zdC5leHBpcmVzQXQgPSBEYXRlLm5vdygpICsgZGF0YS5leHBp\ncmVzX2luICogMTAwMDsKICAgIGluc3QudG9rZW5TdGF0dXMgPSAndmFsaWQn\nOwoKICAgIHNjaGVkdWxlUmVmcmVzaChpZCk7CiAgICBjb25zb2xlLmxvZyhg\nW1JFRlJFU0hdICR7aWR9IOKGkiAkeyhkYXRhLmV4cGlyZXNfaW4gLyAzNjAw\nKS50b0ZpeGVkKDEpfSBoYCk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBjb25z\nb2xlLmVycm9yKGBbUkVGUkVTSC1GQUlMXSAke2lkfWAsIGVyci5yZXNwb25z\nZT8uZGF0YSB8fCBlcnIubWVzc2FnZSk7CiAgICBpbnN0LnRva2VuU3RhdHVz\nID0gJ2ludmFsaWQnOwogIH0KfQoKZnVuY3Rpb24gc2NoZWR1bGVSZWZyZXNo\nKGlkKSB7CiAgY2xlYXJUaW1lb3V0KHJlZnJlc2hlcnMuZ2V0KGlkKSk7CiAg\nY29uc3QgaW5zdCA9IGluc3RhbGxhdGlvbnMuZ2V0KGlkKTsKICBpZiAoIWlu\nc3QgfHwgIWluc3QuZXhwaXJlc0F0KSByZXR1cm47CiAgY29uc3QgZGVsYXkg\nPSBNYXRoLm1heChpbnN0LmV4cGlyZXNBdCAtIERhdGUubm93KCkgLSBQQURE\nSU5HX01TLCAwKTsKICBjb25zdCB0ID0gc2V0VGltZW91dCgoKSA9PiByZWZy\nZXNoQWNjZXNzVG9rZW4oaWQpLCBkZWxheSk7CiAgcmVmcmVzaGVycy5zZXQo\naWQsIHQpOwp9Cgphc3luYyBmdW5jdGlvbiBlbnN1cmVGcmVzaFRva2VuKGlk\nKSB7CiAgY29uc3QgaW5zdCA9IGluc3RhbGxhdGlvbnMuZ2V0KGlkKTsKICBp\nZiAoIWluc3QpIHRocm93IG5ldyBFcnJvcignVW5rbm93biBpbnN0YWxsYXRp\nb24nKTsKICBpZiAoIWluc3QuZXhwaXJlc0F0IHx8IGluc3QuZXhwaXJlc0F0\nIC0gRGF0ZS5ub3coKSA8IFBBRERJTkdfTVMpIHsKICAgIGF3YWl0IHJlZnJl\nc2hBY2Nlc3NUb2tlbihpZCk7CiAgfQogIGlmIChpbnN0LnRva2VuU3RhdHVz\nICE9PSAndmFsaWQnKSB0aHJvdyBuZXcgRXJyb3IoJ1Rva2VuIGludmFsaWQn\nKTsKfQoKZnVuY3Rpb24gcmVxdWlyZUluc3RhbGwocmVxLCByZXMpIHsKICBj\nb25zdCBpbnN0YWxsYXRpb25JZCA9IHJlcS5tZXRob2QgPT09ICdHRVQnID8g\ncmVxLnF1ZXJ5Lmluc3RhbGxhdGlvbl9pZCA6IHJlcS5ib2R5Lmluc3RhbGxh\ndGlvbl9pZDsKICBjb25zdCBpbnN0ID0gaW5zdGFsbGF0aW9ucy5nZXQoaW5z\ndGFsbGF0aW9uSWQpOwogIGlmICghaW5zdCB8fCAhaW5zdC5hY2Nlc3NUb2tl\nbikgewogICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxz\nZSwgZXJyb3I6IGBJbnN0YWxsYXRpb24gbm90IGZvdW5kOiAke2luc3RhbGxh\ndGlvbklkfWAgfSk7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgcmV0dXJuIGlu\nc3Q7Cn0KCi8vIEJBU0lDIFJPVVRFUwphcHAuZ2V0KCcvJywgKHJlcSwgcmVz\nKSA9PiB7CiAgY29uc3QgYXV0aGVudGljYXRlZENvdW50ID0gQXJyYXkuZnJv\nbShpbnN0YWxsYXRpb25zLnZhbHVlcygpKS5maWx0ZXIoaW5zdCA9PiBpbnN0\nLnRva2VuU3RhdHVzID09PSAndmFsaWQnKS5sZW5ndGg7CiAgcmVzLmpzb24o\newogICAgc2VydmljZTogIkdvSGlnaExldmVsIE9BdXRoIEJhY2tlbmQiLAog\nICAgdmVyc2lvbjogIjUuNC4wLWFwaS1maXgiLAogICAgaW5zdGFsbHM6IGlu\nc3RhbGxhdGlvbnMuc2l6ZSwKICAgIGF1dGhlbnRpY2F0ZWQ6IGF1dGhlbnRp\nY2F0ZWRDb3VudCwKICAgIHN0YXR1czogIm9wZXJhdGlvbmFsIiwKICAgIGZl\nYXR1cmVzOiBbIm9hdXRoIiwgInByb2R1Y3RzIiwgImltYWdlcyIsICJwcmlj\naW5nIiwgIm1lZGlhLXVwbG9hZCJdLAogICAgZGVidWc6ICJjb21wbGV0ZSBt\ndWx0aS1zdGVwIHdvcmtmbG93IHJlYWR5IiwKICAgIHRzOiBEYXRlLm5vdygp\nCiAgfSk7Cn0pOwoKYXBwLmdldCgnL2hlYWx0aCcsIChyZXEsIHJlcykgPT4g\newogIHJlcy5qc29uKHsgc3RhdHVzOiAnb2snLCB0czogbmV3IERhdGUoKS50\nb0lTT1N0cmluZygpIH0pOwp9KTsKCi8vIE1JU1NJTkcgSU5TVEFMTEFUSU9O\nUyBFTkRQT0lOVCAtIFRoaXMgd2FzIHRoZSBwcm9ibGVtIQphcHAuZ2V0KCcv\naW5zdGFsbGF0aW9ucycsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IGluc3Rh\nbGxMaXN0ID0gQXJyYXkuZnJvbShpbnN0YWxsYXRpb25zLnZhbHVlcygpKS5t\nYXAoaW5zdCA9PiAoewogICAgaWQ6IGluc3QuaWQsCiAgICBsb2NhdGlvbklk\nOiBpbnN0LmxvY2F0aW9uSWQsCiAgICB0b2tlblN0YXR1czogaW5zdC50b2tl\nblN0YXR1cywKICAgIGNyZWF0ZWRBdDogaW5zdC5jcmVhdGVkQXQsCiAgICBl\neHBpcmVzQXQ6IG5ldyBEYXRlKGluc3QuZXhwaXJlc0F0KS50b0lTT1N0cmlu\nZygpLAogICAgc2NvcGVzOiBpbnN0LnNjb3BlcywKICAgIGxhc3RBY3Rpdml0\neTogaW5zdC5sYXN0QWN0aXZpdHkgfHwgaW5zdC5jcmVhdGVkQXQKICB9KSk7\nCiAgCiAgcmVzLmpzb24oewogICAgdG90YWw6IGluc3RhbGxhdGlvbnMuc2l6\nZSwKICAgIGF1dGhlbnRpY2F0ZWQ6IGluc3RhbGxMaXN0LmZpbHRlcihpbnN0\nID0+IGluc3QudG9rZW5TdGF0dXMgPT09ICd2YWxpZCcpLmxlbmd0aCwKICAg\nIGluc3RhbGxhdGlvbnM6IGluc3RhbGxMaXN0LAogICAgd2ViaG9va0VuZHBv\naW50OiAnL3dlYmhvb2svYXBwLXVuaW5zdGFsbCcKICB9KTsKfSk7CgovLyBP\nQXV0aCB0b2tlbiBleGNoYW5nZQphc3luYyBmdW5jdGlvbiBleGNoYW5nZUNv\nZGUoY29kZSwgcmVkaXJlY3RVcmkpIHsKICBjb25zdCBib2R5ID0gbmV3IFVS\nTFNlYXJjaFBhcmFtcyh7CiAgICBjbGllbnRfaWQ6IHByb2Nlc3MuZW52LkdI\nTF9DTElFTlRfSUQsCiAgICBjbGllbnRfc2VjcmV0OiBwcm9jZXNzLmVudi5H\nSExfQ0xJRU5UX1NFQ1JFVCwKICAgIGdyYW50X3R5cGU6ICdhdXRob3JpemF0\naW9uX2NvZGUnLAogICAgY29kZSwKICAgIHJlZGlyZWN0X3VyaTogcmVkaXJl\nY3RVcmkKICB9KTsKICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IGF4aW9zLnBv\nc3QoJ2h0dHBzOi8vc2VydmljZXMubGVhZGNvbm5lY3RvcmhxLmNvbS9vYXV0\naC90b2tlbicsIGJvZHksIHsKICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlw\nZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0sCiAg\nICB0aW1lb3V0OiAxNTAwMAogIH0pOwogIHJldHVybiBkYXRhOwp9CgpmdW5j\ndGlvbiBzdG9yZUluc3RhbGwodG9rZW5EYXRhKSB7CiAgY29uc3QgaWQgPSBg\naW5zdGFsbF8ke0RhdGUubm93KCl9YDsKICBpbnN0YWxsYXRpb25zLnNldChp\nZCwgewogICAgaWQsCiAgICBhY2Nlc3NUb2tlbjogdG9rZW5EYXRhLmFjY2Vz\nc190b2tlbiwKICAgIHJlZnJlc2hUb2tlbjogdG9rZW5EYXRhLnJlZnJlc2hf\ndG9rZW4sCiAgICBleHBpcmVzSW46IHRva2VuRGF0YS5leHBpcmVzX2luLAog\nICAgZXhwaXJlc0F0OiBEYXRlLm5vdygpICsgdG9rZW5EYXRhLmV4cGlyZXNf\naW4gKiAxMDAwLAogICAgbG9jYXRpb25JZDogdG9rZW5EYXRhLmxvY2F0aW9u\nSWQgfHwgJ1dBdms4N1JtVzlyQlNESkhlT3BIJywKICAgIHNjb3BlczogdG9r\nZW5EYXRhLnNjb3BlIHx8ICcnLAogICAgdG9rZW5TdGF0dXM6ICd2YWxpZCcs\nCiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogIH0p\nOwogIHNjaGVkdWxlUmVmcmVzaChpZCk7CiAgY29uc29sZS5sb2coYFtORVcg\nSU5TVEFMTF0gJHtpZH0gc3RvcmVkIHdpdGggbG9jYXRpb24gJHt0b2tlbkRh\ndGEubG9jYXRpb25JZCB8fCAnV0F2azg3Um1XOXJCU0RKSGVPcEgnfWApOwog\nIHJldHVybiBpZDsKfQoKLy8gT0FVVEggQ0FMTEJBQ0sgLSBFbmhhbmNlZCB3\naXRoIGJldHRlciBsb2dnaW5nCmFwcC5nZXQoWycvb2F1dGgvY2FsbGJhY2sn\nLCAnL2FwaS9vYXV0aC9jYWxsYmFjayddLCBhc3luYyAocmVxLCByZXMpID0+\nIHsKICBjb25zb2xlLmxvZygnPT09IE9BVVRIIENBTExCQUNLIFJFQ0VJVkVE\nID09PScpOwogIGNvbnNvbGUubG9nKCdRdWVyeSBwYXJhbXM6JywgcmVxLnF1\nZXJ5KTsKICBjb25zb2xlLmxvZygnSGVhZGVyczonLCByZXEuaGVhZGVycyk7\nCiAgCiAgY29uc3QgeyBjb2RlLCBlcnJvciwgc3RhdGUgfSA9IHJlcS5xdWVy\neTsKICAKICBpZiAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ09BdXRo\nIGVycm9yIGZyb20gR0hMOicsIGVycm9yKTsKICAgIHJldHVybiByZXMuc3Rh\ndHVzKDQwMCkuanNvbih7IGVycm9yOiAnT0F1dGggZXJyb3InLCBkZXRhaWxz\nOiBlcnJvciB9KTsKICB9CiAgCiAgaWYgKCFjb2RlKSB7CiAgICBjb25zb2xl\nLmVycm9yKCdObyBhdXRob3JpemF0aW9uIGNvZGUgcmVjZWl2ZWQnKTsKICAg\nIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnY29kZSBy\nZXF1aXJlZCcgfSk7CiAgfQogIAogIHRyeSB7CiAgICBjb25zdCByZWRpcmVj\ndFVyaSA9IHJlcS5wYXRoLnN0YXJ0c1dpdGgoJy9hcGknKQogICAgICA/IChw\ncm9jZXNzLmVudi5HSExfUkVESVJFQ1RfVVJJIHx8ICdodHRwczovL2Rpci5l\nbmdhZ2VhdXRvbWF0aW9ucy5jb20vYXBpL29hdXRoL2NhbGxiYWNrJykKICAg\nICAgOiAocHJvY2Vzcy5lbnYuR0hMX1JFRElSRUNUX1VSSSB8fCAnaHR0cHM6\nLy9kaXIuZW5nYWdlYXV0b21hdGlvbnMuY29tL29hdXRoL2NhbGxiYWNrJyk7\nCgogICAgY29uc29sZS5sb2coJ0V4Y2hhbmdpbmcgY29kZSBmb3IgdG9rZW5z\nLi4uJyk7CiAgICBjb25zb2xlLmxvZygnUmVkaXJlY3QgVVJJOicsIHJlZGly\nZWN0VXJpKTsKICAgIAogICAgY29uc3QgdG9rZW5EYXRhID0gYXdhaXQgZXhj\naGFuZ2VDb2RlKGNvZGUsIHJlZGlyZWN0VXJpKTsKICAgIGNvbnNvbGUubG9n\nKCdUb2tlbiBleGNoYW5nZSBzdWNjZXNzZnVsJyk7CiAgICAKICAgIGNvbnN0\nIGlkID0gc3RvcmVJbnN0YWxsKHRva2VuRGF0YSk7CiAgICBjb25zb2xlLmxv\nZygnSW5zdGFsbGF0aW9uIHN0b3JlZCB3aXRoIElEOicsIGlkKTsKICAgIAog\nICAgY29uc3QgdXJsID0gYGh0dHBzOi8vbGlzdGluZ3MuZW5nYWdlYXV0b21h\ndGlvbnMuY29tLz9pbnN0YWxsYXRpb25faWQ9JHtpZH0md2VsY29tZT10cnVl\nYDsKICAgIGNvbnNvbGUubG9nKCdSZWRpcmVjdGluZyB0bzonLCB1cmwpOwog\nICAgCiAgICByZXMucmVkaXJlY3QodXJsKTsKICB9IGNhdGNoIChlKSB7CiAg\nICBjb25zb2xlLmVycm9yKCdPQXV0aCBlcnJvcjonLCBlLnJlc3BvbnNlPy5k\nYXRhIHx8IGUubWVzc2FnZSk7CiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7\nIGVycm9yOiAnT0F1dGggZmFpbGVkJywgZGV0YWlsczogZS5yZXNwb25zZT8u\nZGF0YSB8fCBlLm1lc3NhZ2UgfSk7CiAgfQp9KTsKCmFwcC5nZXQoJy9hcGkv\nb2F1dGgvc3RhdHVzJywgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgaW5zdCA9\nIGluc3RhbGxhdGlvbnMuZ2V0KHJlcS5xdWVyeS5pbnN0YWxsYXRpb25faWQp\nOwogIGlmICghaW5zdCkgcmV0dXJuIHJlcy5qc29uKHsgYXV0aGVudGljYXRl\nZDogZmFsc2UgfSk7CiAgcmVzLmpzb24oeyBhdXRoZW50aWNhdGVkOiB0cnVl\nLCB0b2tlblN0YXR1czogaW5zdC50b2tlblN0YXR1cywgbG9jYXRpb25JZDog\naW5zdC5sb2NhdGlvbklkIH0pOwp9KTsKCi8vIE1FRElBIFVQTE9BRCBFTkRQ\nT0lOVAphcHAucG9zdCgnL2FwaS9tZWRpYS91cGxvYWQnLCB1cGxvYWQuc2lu\nZ2xlKCdmaWxlJyksIGFzeW5jIChyZXEsIHJlcykgPT4gewogIGNvbnNvbGUu\nbG9nKCc9PT0gTUVESUEgVVBMT0FEIFJFUVVFU1QgPT09Jyk7CiAgCiAgdHJ5\nIHsKICAgIGNvbnN0IHsgaW5zdGFsbGF0aW9uX2lkIH0gPSByZXEuYm9keTsK\nICAgIAogICAgaWYgKCFpbnN0YWxsYXRpb25faWQpIHsKICAgICAgcmV0dXJu\nIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9y\nOiAnaW5zdGFsbGF0aW9uX2lkIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAog\nICAgaWYgKCFyZXEuZmlsZSkgewogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0\nMDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdmaWxlIHJlcXVp\ncmVkJyB9KTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2coYFVwbG9hZGlu\nZyBmaWxlOiAke3JlcS5maWxlLm9yaWdpbmFsbmFtZX0gKCR7cmVxLmZpbGUu\nc2l6ZX0gYnl0ZXMpYCk7CiAgICAKICAgIGF3YWl0IGVuc3VyZUZyZXNoVG9r\nZW4oaW5zdGFsbGF0aW9uX2lkKTsKICAgIGNvbnN0IGluc3RhbGxhdGlvbiA9\nIGluc3RhbGxhdGlvbnMuZ2V0KGluc3RhbGxhdGlvbl9pZCk7CiAgICAKICAg\nIC8vIENyZWF0ZSBmb3JtIGRhdGEgZm9yIEdvSGlnaExldmVsIEFQSQogICAg\nY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgIGZvcm1EYXRh\nLmFwcGVuZCgnZmlsZScsIGZzLmNyZWF0ZVJlYWRTdHJlYW0ocmVxLmZpbGUu\ncGF0aCksIHsKICAgICAgZmlsZW5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFt\nZSwKICAgICAgY29udGVudFR5cGU6IHJlcS5maWxlLm1pbWV0eXBlCiAgICB9\nKTsKICAgIAogICAgLy8gVXBsb2FkIHRvIEdvSGlnaExldmVsIG1lZGlhIGxp\nYnJhcnkKICAgIGNvbnN0IHVwbG9hZFJlc3BvbnNlID0gYXdhaXQgYXhpb3Mu\ncG9zdChgaHR0cHM6Ly9zZXJ2aWNlcy5sZWFkY29ubmVjdG9yaHEuY29tL21l\nZGlhcy91cGxvYWQtZmlsZWAsIGZvcm1EYXRhLCB7CiAgICAgIGhlYWRlcnM6\nIHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtpbnN0YWxs\nYXRpb24uYWNjZXNzVG9rZW59YCwKICAgICAgICAnVmVyc2lvbic6ICcyMDIx\nLTA3LTI4JywKICAgICAgICAuLi5mb3JtRGF0YS5nZXRIZWFkZXJzKCkKICAg\nICAgfSwKICAgICAgcGFyYW1zOiB7CiAgICAgICAgbG9jYXRpb25JZDogaW5z\ndGFsbGF0aW9uLmxvY2F0aW9uSWQKICAgICAgfQogICAgfSk7CiAgICAKICAg\nIC8vIENsZWFuIHVwIHVwbG9hZGVkIGZpbGUKICAgIGZzLnVubGlua1N5bmMo\ncmVxLmZpbGUucGF0aCk7CiAgICAKICAgIGNvbnNvbGUubG9nKCdNZWRpYSB1\ncGxvYWQgc3VjY2Vzc2Z1bDonLCB1cGxvYWRSZXNwb25zZS5kYXRhKTsKICAg\nIAogICAgcmVzLmpzb24oewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICBt\nZWRpYVVybDogdXBsb2FkUmVzcG9uc2UuZGF0YS51cmwgfHwgdXBsb2FkUmVz\ncG9uc2UuZGF0YS5maWxlVXJsLAogICAgICBtZWRpYUlkOiB1cGxvYWRSZXNw\nb25zZS5kYXRhLmlkLAogICAgICBkYXRhOiB1cGxvYWRSZXNwb25zZS5kYXRh\nCiAgICB9KTsKICAgIAogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAvLyBDbGVh\nbiB1cCBmaWxlIGlmIGl0IGV4aXN0cwogICAgaWYgKHJlcS5maWxlICYmIGZz\nLmV4aXN0c1N5bmMocmVxLmZpbGUucGF0aCkpIHsKICAgICAgZnMudW5saW5r\nU3luYyhyZXEuZmlsZS5wYXRoKTsKICAgIH0KICAgIAogICAgY29uc29sZS5l\ncnJvcignTWVkaWEgdXBsb2FkIGVycm9yOicsIGVycm9yLnJlc3BvbnNlPy5k\nYXRhIHx8IGVycm9yLm1lc3NhZ2UpOwogICAgcmVzLnN0YXR1cyg1MDApLmpz\nb24oewogICAgICBzdWNjZXNzOiBmYWxzZSwKICAgICAgZXJyb3I6IGVycm9y\nLnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yLm1lc3NhZ2UKICAgIH0pOwogIH0K\nfSk7CgovLyBNRURJQSBMSVNUIEVORFBPSU5UCmFwcC5nZXQoJy9hcGkvbWVk\naWEvbGlzdCcsIGFzeW5jIChyZXEsIHJlcykgPT4gewogIHRyeSB7CiAgICBj\nb25zdCB7IGluc3RhbGxhdGlvbl9pZCB9ID0gcmVxLnF1ZXJ5OwogICAgCiAg\nICBpZiAoIWluc3RhbGxhdGlvbl9pZCkgewogICAgICByZXR1cm4gcmVzLnN0\nYXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdpbnN0\nYWxsYXRpb25faWQgcmVxdWlyZWQnIH0pOwogICAgfQogICAgCiAgICBhd2Fp\ndCBlbnN1cmVGcmVzaFRva2VuKGluc3RhbGxhdGlvbl9pZCk7CiAgICBjb25z\ndCBpbnN0YWxsYXRpb24gPSBpbnN0YWxsYXRpb25zLmdldChpbnN0YWxsYXRp\nb25faWQpOwogICAgCiAgICBjb25zdCBtZWRpYVJlc3BvbnNlID0gYXdhaXQg\nYXhpb3MuZ2V0KCdodHRwczovL3NlcnZpY2VzLmxlYWRjb25uZWN0b3JocS5j\nb20vbWVkaWFzLycsIHsKICAgICAgaGVhZGVyczogewogICAgICAgICdBdXRo\nb3JpemF0aW9uJzogYEJlYXJlciAke2luc3RhbGxhdGlvbi5hY2Nlc3NUb2tl\nbn1gLAogICAgICAgICdWZXJzaW9uJzogJzIwMjEtMDctMjgnCiAgICAgIH0s\nCiAgICAgIHBhcmFtczogewogICAgICAgIGxvY2F0aW9uSWQ6IGluc3RhbGxh\ndGlvbi5sb2NhdGlvbklkLAogICAgICAgIGxpbWl0OiAxMDAKICAgICAgfQog\nICAgfSk7CiAgICAKICAgIHJlcy5qc29uKHsKICAgICAgc3VjY2VzczogdHJ1\nZSwKICAgICAgbWVkaWE6IG1lZGlhUmVzcG9uc2UuZGF0YS5tZWRpYXMgfHwg\nbWVkaWFSZXNwb25zZS5kYXRhLAogICAgICB0b3RhbDogbWVkaWFSZXNwb25z\nZS5kYXRhLmNvdW50IHx8IG1lZGlhUmVzcG9uc2UuZGF0YS5sZW5ndGgKICAg\nIH0pOwogICAgCiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJy\nb3IoJ01lZGlhIGxpc3QgZXJyb3I6JywgZXJyb3IucmVzcG9uc2U/LmRhdGEg\nfHwgZXJyb3IubWVzc2FnZSk7CiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7\nCiAgICAgIHN1Y2Nlc3M6IGZhbHNlLAogICAgICBlcnJvcjogZXJyb3IucmVz\ncG9uc2U/LmRhdGEgfHwgZXJyb3IubWVzc2FnZQogICAgfSk7CiAgfQp9KTsK\nCi8vIFBSSUNJTkcgRU5EUE9JTlQKYXBwLnBvc3QoJy9hcGkvcHJvZHVjdHMv\nOnByb2R1Y3RJZC9wcmljZXMnLCBhc3luYyAocmVxLCByZXMpID0+IHsKICB0\ncnkgewogICAgY29uc3QgeyBwcm9kdWN0SWQgfSA9IHJlcS5wYXJhbXM7CiAg\nICBjb25zdCB7IGluc3RhbGxhdGlvbl9pZCwgbmFtZSwgdHlwZSwgYW1vdW50\nLCBjdXJyZW5jeSB9ID0gcmVxLmJvZHk7CiAgICAKICAgIGlmICghaW5zdGFs\nbGF0aW9uX2lkKSB7CiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNv\nbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2luc3RhbGxhdGlvbl9pZCBy\nZXF1aXJlZCcgfSk7CiAgICB9CiAgICAKICAgIGF3YWl0IGVuc3VyZUZyZXNo\nVG9rZW4oaW5zdGFsbGF0aW9uX2lkKTsKICAgIGNvbnN0IGluc3RhbGxhdGlv\nbiA9IGluc3RhbGxhdGlvbnMuZ2V0KGluc3RhbGxhdGlvbl9pZCk7CiAgICAK\nICAgIGNvbnN0IHByaWNlRGF0YSA9IHsKICAgICAgbmFtZSwKICAgICAgdHlw\nZSwKICAgICAgYW1vdW50OiBwYXJzZUludChhbW91bnQpLAogICAgICBjdXJy\nZW5jeTogY3VycmVuY3kgfHwgJ1VTRCcKICAgIH07CiAgICAKICAgIGNvbnN0\nIHByaWNlUmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwczovL3Nl\ncnZpY2VzLmxlYWRjb25uZWN0b3JocS5jb20vcHJvZHVjdHMvJHtwcm9kdWN0\nSWR9L3ByaWNlc2AsIHByaWNlRGF0YSwgewogICAgICBoZWFkZXJzOiB7CiAg\nICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aW5zdGFsbGF0aW9u\nLmFjY2Vzc1Rva2VufWAsCiAgICAgICAgJ1ZlcnNpb24nOiAnMjAyMS0wNy0y\nOCcsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29u\nJwogICAgICB9CiAgICB9KTsKICAgIAogICAgY29uc29sZS5sb2coJ1ByaWNl\nIGNyZWF0ZWQ6JywgcHJpY2VSZXNwb25zZS5kYXRhKTsKICAgIAogICAgcmVz\nLmpzb24oewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICBwcmljZTogcHJp\nY2VSZXNwb25zZS5kYXRhCiAgICB9KTsKICAgIAogIH0gY2F0Y2ggKGVycm9y\nKSB7CiAgICBjb25zb2xlLmVycm9yKCdQcmljZSBjcmVhdGlvbiBlcnJvcjon\nLCBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5tZXNzYWdlKTsKICAg\nIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsKICAgICAgc3VjY2VzczogZmFsc2Us\nCiAgICAgIGVycm9yOiBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5t\nZXNzYWdlCiAgICB9KTsKICB9Cn0pOwoKLy8gUFJPRFVDVCBDUkVBVElPTiBF\nTkRQT0lOVAphcHAucG9zdCgnL2FwaS9wcm9kdWN0cy9jcmVhdGUnLCBhc3lu\nYyAocmVxLCByZXMpID0+IHsKICBjb25zb2xlLmxvZygnPT09IFBST0RVQ1Qg\nQ1JFQVRJT04gUkVRVUVTVCA9PT0nKTsKICAKICB0cnkgewogICAgY29uc3Qg\neyBuYW1lLCBkZXNjcmlwdGlvbiwgcHJvZHVjdFR5cGUsIHNrdSwgY3VycmVu\nY3ksIGluc3RhbGxhdGlvbl9pZCB9ID0gcmVxLmJvZHk7CiAgICAKICAgIGlm\nICghaW5zdGFsbGF0aW9uX2lkKSB7CiAgICAgIHJldHVybiByZXMuc3RhdHVz\nKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2luc3RhbGxh\ndGlvbl9pZCByZXF1aXJlZCcgfSk7CiAgICB9CiAgICAKICAgIGlmICghbmFt\nZSkgewogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNj\nZXNzOiBmYWxzZSwgZXJyb3I6ICdwcm9kdWN0IG5hbWUgcmVxdWlyZWQnIH0p\nOwogICAgfQogICAgCiAgICBjb25zb2xlLmxvZyhgQ3JlYXRpbmcgcHJvZHVj\ndDogJHtuYW1lfWApOwogICAgCiAgICBhd2FpdCBlbnN1cmVGcmVzaFRva2Vu\nKGluc3RhbGxhdGlvbl9pZCk7CiAgICBjb25zdCBpbnN0YWxsYXRpb24gPSBp\nbnN0YWxsYXRpb25zLmdldChpbnN0YWxsYXRpb25faWQpOwogICAgCiAgICBj\nb25zdCBwcm9kdWN0RGF0YSA9IHsKICAgICAgbmFtZSwKICAgICAgZGVzY3Jp\ncHRpb246IGRlc2NyaXB0aW9uIHx8ICcnLAogICAgICB0eXBlOiBwcm9kdWN0\nVHlwZSB8fCAnUEhZU0lDQUwnLCAvLyBHb0hpZ2hMZXZlbCBBUEkgdXNlcyAn\ndHlwZScgbm90ICdwcm9kdWN0VHlwZScKICAgICAgbG9jYXRpb25JZDogaW5z\ndGFsbGF0aW9uLmxvY2F0aW9uSWQsCiAgICAgIC4uLihza3UgJiYgeyBza3Ug\nfSksCiAgICAgIC4uLihjdXJyZW5jeSAmJiB7IGN1cnJlbmN5IH0pCiAgICB9\nOwogICAgCiAgICAvLyBDcmVhdGUgcHJvZHVjdCBpbiBHb0hpZ2hMZXZlbAog\nICAgY29uc3QgcHJvZHVjdFJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgn\naHR0cHM6Ly9zZXJ2aWNlcy5sZWFkY29ubmVjdG9yaHEuY29tL3Byb2R1Y3Rz\nLycsIHByb2R1Y3REYXRhLCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAn\nQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtpbnN0YWxsYXRpb24uYWNjZXNz\nVG9rZW59YCwKICAgICAgICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywKICAg\nICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAg\nIH0KICAgIH0pOwogICAgCiAgICBjb25zb2xlLmxvZygnUHJvZHVjdCBjcmVh\ndGlvbiBzdWNjZXNzZnVsOicsIHByb2R1Y3RSZXNwb25zZS5kYXRhKTsKICAg\nIAogICAgcmVzLmpzb24oewogICAgICBzdWNjZXNzOiB0cnVlLAogICAgICBw\ncm9kdWN0OiBwcm9kdWN0UmVzcG9uc2UuZGF0YS5wcm9kdWN0IHx8IHByb2R1\nY3RSZXNwb25zZS5kYXRhLAogICAgICBtZXNzYWdlOiAnUHJvZHVjdCBjcmVh\ndGVkIHN1Y2Nlc3NmdWxseSBpbiBHb0hpZ2hMZXZlbCcKICAgIH0pOwogICAg\nCiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ1Byb2R1\nY3QgY3JlYXRpb24gZXJyb3I6JywgZXJyb3IucmVzcG9uc2U/LmRhdGEgfHwg\nZXJyb3IubWVzc2FnZSk7CiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdGF0\ndXM6JywgZXJyb3IucmVzcG9uc2U/LnN0YXR1cyk7CiAgICBjb25zb2xlLmVy\ncm9yKCdFcnJvciBoZWFkZXJzOicsIGVycm9yLnJlc3BvbnNlPy5oZWFkZXJz\nKTsKICAgIGNvbnNvbGUuZXJyb3IoJ0Z1bGwgZXJyb3I6JywgZXJyb3IpOwog\nICAgcmVzLnN0YXR1cyg1MDApLmpzb24oewogICAgICBzdWNjZXNzOiBmYWxz\nZSwKICAgICAgZXJyb3I6IGVycm9yLnJlc3BvbnNlPy5kYXRhIHx8IGVycm9y\nLm1lc3NhZ2UsCiAgICAgIHN0YXR1czogZXJyb3IucmVzcG9uc2U/LnN0YXR1\ncywKICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgcHJvZHVjdCBp\nbiBHb0hpZ2hMZXZlbCcKICAgIH0pOwogIH0KfSk7CgovLyBQUk9EVUNUIExJ\nU1RJTkcgRU5EUE9JTlQKYXBwLmdldCgnL2FwaS9wcm9kdWN0cy9saXN0Jywg\nYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc29sZS5sb2coJz09PSBQUk9E\nVUNUIExJU1RJTkcgUkVRVUVTVCA9PT0nKTsKICAKICB0cnkgewogICAgY29u\nc3QgeyBpbnN0YWxsYXRpb25faWQgfSA9IHJlcS5xdWVyeTsKICAgIAogICAg\naWYgKCFpbnN0YWxsYXRpb25faWQpIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0\ndXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnaW5zdGFs\nbGF0aW9uX2lkIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgYXdhaXQg\nZW5zdXJlRnJlc2hUb2tlbihpbnN0YWxsYXRpb25faWQpOwogICAgY29uc3Qg\naW5zdGFsbGF0aW9uID0gaW5zdGFsbGF0aW9ucy5nZXQoaW5zdGFsbGF0aW9u\nX2lkKTsKICAgIAogICAgY29uc3QgcHJvZHVjdHNSZXNwb25zZSA9IGF3YWl0\nIGF4aW9zLmdldCgnaHR0cHM6Ly9zZXJ2aWNlcy5sZWFkY29ubmVjdG9yaHEu\nY29tL3Byb2R1Y3RzLycsIHsKICAgICAgaGVhZGVyczogewogICAgICAgICdB\ndXRob3JpemF0aW9uJzogYEJlYXJlciAke2luc3RhbGxhdGlvbi5hY2Nlc3NU\nb2tlbn1gLAogICAgICAgICdWZXJzaW9uJzogJzIwMjEtMDctMjgnCiAgICAg\nIH0sCiAgICAgIHBhcmFtczogewogICAgICAgIGxvY2F0aW9uSWQ6IGluc3Rh\nbGxhdGlvbi5sb2NhdGlvbklkLAogICAgICAgIGxpbWl0OiAxMDAKICAgICAg\nfQogICAgfSk7CiAgICAKICAgIGNvbnNvbGUubG9nKCdQcm9kdWN0cyByZXRy\naWV2ZWQ6JywgcHJvZHVjdHNSZXNwb25zZS5kYXRhLnByb2R1Y3RzPy5sZW5n\ndGggfHwgMCk7CiAgICAKICAgIHJlcy5qc29uKHsKICAgICAgc3VjY2Vzczog\ndHJ1ZSwKICAgICAgcHJvZHVjdHM6IHByb2R1Y3RzUmVzcG9uc2UuZGF0YS5w\ncm9kdWN0cyB8fCBbXSwKICAgICAgY291bnQ6IHByb2R1Y3RzUmVzcG9uc2Uu\nZGF0YS5wcm9kdWN0cz8ubGVuZ3RoIHx8IDAKICAgIH0pOwogICAgCiAgfSBj\nYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ1Byb2R1Y3QgbGlz\ndGluZyBlcnJvcjonLCBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5t\nZXNzYWdlKTsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsKICAgICAgc3Vj\nY2VzczogZmFsc2UsCiAgICAgIGVycm9yOiBlcnJvci5yZXNwb25zZT8uZGF0\nYSB8fCBlcnJvci5tZXNzYWdlLAogICAgICBtZXNzYWdlOiAnRmFpbGVkIHRv\nIHJldHJpZXZlIHByb2R1Y3RzIGZyb20gR29IaWdoTGV2ZWwnCiAgICB9KTsK\nICB9Cn0pOwoKLy8gQ09MTEVDVElPTiBNQU5BR0VNRU5UIEVORFBPSU5UUwoK\nLy8gQ3JlYXRlIHByb2R1Y3QgY29sbGVjdGlvbgphcHAucG9zdCgnL2FwaS9j\nb2xsZWN0aW9ucy9jcmVhdGUnLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBj\nb25zb2xlLmxvZygnPT09IENPTExFQ1RJT04gQ1JFQVRJT04gUkVRVUVTVCA9\nPT0nKTsKICAKICB0cnkgewogICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlv\nbiwgcHJvZHVjdElkcyA9IFtdLCBpbnN0YWxsYXRpb25faWQgfSA9IHJlcS5i\nb2R5OwogICAgCiAgICBpZiAoIWluc3RhbGxhdGlvbl9pZCkgewogICAgICBy\nZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwg\nZXJyb3I6ICdpbnN0YWxsYXRpb25faWQgcmVxdWlyZWQnIH0pOwogICAgfQog\nICAgCiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0dXMo\nNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnY29sbGVjdGlv\nbiBuYW1lIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgY29uc29sZS5s\nb2coYENyZWF0aW5nIGNvbGxlY3Rpb246ICR7bmFtZX1gKTsKICAgIGNvbnNv\nbGUubG9nKGBQcm9kdWN0cyB0byBpbmNsdWRlOiAke3Byb2R1Y3RJZHMubGVu\nZ3RofWApOwogICAgCiAgICBhd2FpdCBlbnN1cmVGcmVzaFRva2VuKGluc3Rh\nbGxhdGlvbl9pZCk7CiAgICBjb25zdCBpbnN0YWxsYXRpb24gPSBpbnN0YWxs\nYXRpb25zLmdldChpbnN0YWxsYXRpb25faWQpOwogICAgCiAgICBjb25zdCBj\nb2xsZWN0aW9uRGF0YSA9IHsKICAgICAgbmFtZSwKICAgICAgZGVzY3JpcHRp\nb246IGRlc2NyaXB0aW9uIHx8ICcnLAogICAgICBwcm9kdWN0SWRzOiBwcm9k\ndWN0SWRzLAogICAgICBsb2NhdGlvbklkOiBpbnN0YWxsYXRpb24ubG9jYXRp\nb25JZAogICAgfTsKICAgIAogICAgY29uc3QgY29sbGVjdGlvblJlc3BvbnNl\nID0gYXdhaXQgYXhpb3MucG9zdCgnaHR0cHM6Ly9zZXJ2aWNlcy5sZWFkY29u\nbmVjdG9yaHEuY29tL2NvbGxlY3Rpb25zLycsIGNvbGxlY3Rpb25EYXRhLCB7\nCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBC\nZWFyZXIgJHtpbnN0YWxsYXRpb24uYWNjZXNzVG9rZW59YCwKICAgICAgICAn\nVmVyc2lvbic6ICcyMDIxLTA3LTI4JywKICAgICAgICAnQ29udGVudC1UeXBl\nJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgIH0KICAgIH0pOwogICAgCiAg\nICBjb25zb2xlLmxvZygnQ29sbGVjdGlvbiBjcmVhdGVkOicsIGNvbGxlY3Rp\nb25SZXNwb25zZS5kYXRhKTsKICAgIAogICAgcmVzLmpzb24oewogICAgICBz\ndWNjZXNzOiB0cnVlLAogICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uUmVz\ncG9uc2UuZGF0YSwKICAgICAgbWVzc2FnZTogJ0NvbGxlY3Rpb24gY3JlYXRl\nZCBzdWNjZXNzZnVsbHknCiAgICB9KTsKICAgIAogIH0gY2F0Y2ggKGVycm9y\nKSB7CiAgICBjb25zb2xlLmVycm9yKCdDb2xsZWN0aW9uIGNyZWF0aW9uIGVy\ncm9yOicsIGVycm9yLnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yLm1lc3NhZ2Up\nOwogICAgcmVzLnN0YXR1cyg1MDApLmpzb24oewogICAgICBzdWNjZXNzOiBm\nYWxzZSwKICAgICAgZXJyb3I6IGVycm9yLnJlc3BvbnNlPy5kYXRhIHx8IGVy\ncm9yLm1lc3NhZ2UsCiAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRl\nIGNvbGxlY3Rpb24nCiAgICB9KTsKICB9Cn0pOwoKLy8gTGlzdCBhbGwgY29s\nbGVjdGlvbnMKYXBwLmdldCgnL2FwaS9jb2xsZWN0aW9ucy9saXN0JywgYXN5\nbmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc29sZS5sb2coJz09PSBDT0xMRUNU\nSU9OIExJU1QgUkVRVUVTVCA9PT0nKTsKICAKICB0cnkgewogICAgY29uc3Qg\neyBpbnN0YWxsYXRpb25faWQgfSA9IHJlcS5xdWVyeTsKICAgIAogICAgaWYg\nKCFpbnN0YWxsYXRpb25faWQpIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0dXMo\nNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnaW5zdGFsbGF0\naW9uX2lkIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgYXdhaXQgZW5z\ndXJlRnJlc2hUb2tlbihpbnN0YWxsYXRpb25faWQpOwogICAgY29uc3QgaW5z\ndGFsbGF0aW9uID0gaW5zdGFsbGF0aW9ucy5nZXQoaW5zdGFsbGF0aW9uX2lk\nKTsKICAgIAogICAgY29uc3QgY29sbGVjdGlvbnNSZXNwb25zZSA9IGF3YWl0\nIGF4aW9zLmdldCgnaHR0cHM6Ly9zZXJ2aWNlcy5sZWFkY29ubmVjdG9yaHEu\nY29tL2NvbGxlY3Rpb25zLycsIHsKICAgICAgaGVhZGVyczogewogICAgICAg\nICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2luc3RhbGxhdGlvbi5hY2Nl\nc3NUb2tlbn1gLAogICAgICAgICdWZXJzaW9uJzogJzIwMjEtMDctMjgnCiAg\nICAgIH0sCiAgICAgIHBhcmFtczogewogICAgICAgIGxvY2F0aW9uSWQ6IGlu\nc3RhbGxhdGlvbi5sb2NhdGlvbklkCiAgICAgIH0KICAgIH0pOwogICAgCiAg\nICBjb25zb2xlLmxvZygnQ29sbGVjdGlvbnMgcmV0cmlldmVkOicsIGNvbGxl\nY3Rpb25zUmVzcG9uc2UuZGF0YS5jb2xsZWN0aW9ucz8ubGVuZ3RoIHx8IDAp\nOwogICAgCiAgICByZXMuanNvbih7CiAgICAgIHN1Y2Nlc3M6IHRydWUsCiAg\nICAgIGNvbGxlY3Rpb25zOiBjb2xsZWN0aW9uc1Jlc3BvbnNlLmRhdGEuY29s\nbGVjdGlvbnMgfHwgW10sCiAgICAgIGNvdW50OiBjb2xsZWN0aW9uc1Jlc3Bv\nbnNlLmRhdGEuY29sbGVjdGlvbnM/Lmxlbmd0aCB8fCAwCiAgICB9KTsKICAg\nIAogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCdDb2xs\nZWN0aW9uIGxpc3RpbmcgZXJyb3I6JywgZXJyb3IucmVzcG9uc2U/LmRhdGEg\nfHwgZXJyb3IubWVzc2FnZSk7CiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7\nCiAgICAgIHN1Y2Nlc3M6IGZhbHNlLAogICAgICBlcnJvcjogZXJyb3IucmVz\ncG9uc2U/LmRhdGEgfHwgZXJyb3IubWVzc2FnZSwKICAgICAgbWVzc2FnZTog\nJ0ZhaWxlZCB0byByZXRyaWV2ZSBjb2xsZWN0aW9ucycKICAgIH0pOwogIH0K\nfSk7CgovLyBBZGQgcHJvZHVjdHMgdG8gZXhpc3RpbmcgY29sbGVjdGlvbgph\ncHAucG9zdCgnL2FwaS9jb2xsZWN0aW9ucy86Y29sbGVjdGlvbklkL3Byb2R1\nY3RzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc29sZS5sb2coJz09\nPSBBREQgUFJPRFVDVFMgVE8gQ09MTEVDVElPTiA9PT0nKTsKICAKICB0cnkg\newogICAgY29uc3QgeyBjb2xsZWN0aW9uSWQgfSA9IHJlcS5wYXJhbXM7CiAg\nICBjb25zdCB7IHByb2R1Y3RJZHMsIGluc3RhbGxhdGlvbl9pZCB9ID0gcmVx\nLmJvZHk7CiAgICAKICAgIGlmICghaW5zdGFsbGF0aW9uX2lkKSB7CiAgICAg\nIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNl\nLCBlcnJvcjogJ2luc3RhbGxhdGlvbl9pZCByZXF1aXJlZCcgfSk7CiAgICB9\nCiAgICAKICAgIGlmICghcHJvZHVjdElkcyB8fCAhQXJyYXkuaXNBcnJheShw\ncm9kdWN0SWRzKSkgewogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpz\nb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdwcm9kdWN0SWRzIGFycmF5\nIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2coYEFk\nZGluZyAke3Byb2R1Y3RJZHMubGVuZ3RofSBwcm9kdWN0cyB0byBjb2xsZWN0\naW9uICR7Y29sbGVjdGlvbklkfWApOwogICAgCiAgICBhd2FpdCBlbnN1cmVG\ncmVzaFRva2VuKGluc3RhbGxhdGlvbl9pZCk7CiAgICBjb25zdCBpbnN0YWxs\nYXRpb24gPSBpbnN0YWxsYXRpb25zLmdldChpbnN0YWxsYXRpb25faWQpOwog\nICAgCiAgICBjb25zdCB1cGRhdGVSZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBh\ndGNoKGBodHRwczovL3NlcnZpY2VzLmxlYWRjb25uZWN0b3JocS5jb20vY29s\nbGVjdGlvbnMvJHtjb2xsZWN0aW9uSWR9YCwgewogICAgICBwcm9kdWN0SWRz\nOiBwcm9kdWN0SWRzCiAgICB9LCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAg\nICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtpbnN0YWxsYXRpb24uYWNj\nZXNzVG9rZW59YCwKICAgICAgICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywK\nICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAg\nICAgIH0KICAgIH0pOwogICAgCiAgICBjb25zb2xlLmxvZygnUHJvZHVjdHMg\nYWRkZWQgdG8gY29sbGVjdGlvbjonLCB1cGRhdGVSZXNwb25zZS5kYXRhKTsK\nICAgIAogICAgcmVzLmpzb24oewogICAgICBzdWNjZXNzOiB0cnVlLAogICAg\nICBjb2xsZWN0aW9uOiB1cGRhdGVSZXNwb25zZS5kYXRhLAogICAgICBtZXNz\nYWdlOiAnUHJvZHVjdHMgYWRkZWQgdG8gY29sbGVjdGlvbiBzdWNjZXNzZnVs\nbHknCiAgICB9KTsKICAgIAogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25z\nb2xlLmVycm9yKCdBZGQgcHJvZHVjdHMgdG8gY29sbGVjdGlvbiBlcnJvcjon\nLCBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5tZXNzYWdlKTsKICAg\nIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsKICAgICAgc3VjY2VzczogZmFsc2Us\nCiAgICAgIGVycm9yOiBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5t\nZXNzYWdlLAogICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGFkZCBwcm9kdWN0\ncyB0byBjb2xsZWN0aW9uJwogICAgfSk7CiAgfQp9KTsKCi8vIENPTVBMRVRF\nIFBST0RVQ1QgV09SS0ZMT1cgV0lUSCBQSE9UT1MgQU5EIFBSSUNJTkcKCi8v\nIENvbXBsZXRlIHByb2R1Y3QgY3JlYXRpb24gd29ya2Zsb3c6IHBob3RvcyDi\nhpIgcHJvZHVjdCDihpIgcHJpY2luZwphcHAucG9zdCgnL2FwaS93b3JrZmxv\ndy9jb21wbGV0ZS1wcm9kdWN0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAg\nY29uc29sZS5sb2coJz09PSBDT01QTEVURSBQUk9EVUNUIFdPUktGTE9XID09\nPScpOwogIAogIHRyeSB7CiAgICBjb25zdCB7IAogICAgICBuYW1lLCAKICAg\nICAgZGVzY3JpcHRpb24sIAogICAgICBwcm9kdWN0VHlwZSwgCiAgICAgIHNr\ndSwgCiAgICAgIGN1cnJlbmN5LAogICAgICBwaG90b3MgPSBbXSwgLy8gQXJy\nYXkgb2YgcGhvdG8gb2JqZWN0czogW3tmaWxlbmFtZSwgYnVmZmVyLCBtaW1l\ndHlwZX0sIC4uLl0KICAgICAgcHJpY2luZyA9IFtdLCAvLyBBcnJheSBvZiBw\ncmljaW5nIG9iamVjdHM6IFt7bmFtZSwgdHlwZSwgYW1vdW50LCBjdXJyZW5j\neX0sIC4uLl0KICAgICAgaW5zdGFsbGF0aW9uX2lkIAogICAgfSA9IHJlcS5i\nb2R5OwogICAgCiAgICBpZiAoIWluc3RhbGxhdGlvbl9pZCkgewogICAgICBy\nZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwg\nZXJyb3I6ICdpbnN0YWxsYXRpb25faWQgcmVxdWlyZWQnIH0pOwogICAgfQog\nICAgCiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0dXMo\nNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAncHJvZHVjdCBu\nYW1lIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgY29uc29sZS5sb2co\nYFN0YXJ0aW5nIGNvbXBsZXRlIHdvcmtmbG93IGZvcjogJHtuYW1lfWApOwog\nICAgY29uc29sZS5sb2coYFBob3RvcyB0byB1cGxvYWQ6ICR7cGhvdG9zLmxl\nbmd0aH1gKTsKICAgIGNvbnNvbGUubG9nKGBQcmljaW5nIHRpZXJzOiAke3By\naWNpbmcubGVuZ3RofWApOwogICAgCiAgICBhd2FpdCBlbnN1cmVGcmVzaFRv\na2VuKGluc3RhbGxhdGlvbl9pZCk7CiAgICBjb25zdCBpbnN0YWxsYXRpb24g\nPSBpbnN0YWxsYXRpb25zLmdldChpbnN0YWxsYXRpb25faWQpOwogICAgCiAg\nICBjb25zdCB3b3JrZmxvd1Jlc3VsdCA9IHsKICAgICAgcHJvZHVjdDogbnVs\nbCwKICAgICAgdXBsb2FkZWRQaG90b3M6IFtdLAogICAgICBjcmVhdGVkUHJp\nY2VzOiBbXSwKICAgICAgZXJyb3JzOiBbXQogICAgfTsKICAgIAogICAgLy8g\nU3RlcCAxOiBVcGxvYWQgbXVsdGlwbGUgcGhvdG9zIHRvIG1lZGlhIGxpYnJh\ncnkKICAgIGNvbnNvbGUubG9nKCdTdGVwIDE6IFVwbG9hZGluZyBwaG90b3Mg\ndG8gbWVkaWEgbGlicmFyeS4uLicpOwogICAgCiAgICBmb3IgKGxldCBpID0g\nMDsgaSA8IHBob3Rvcy5sZW5ndGg7IGkrKykgewogICAgICB0cnkgewogICAg\nICAgIGNvbnN0IHBob3RvID0gcGhvdG9zW2ldOwogICAgICAgIGNvbnNvbGUu\nbG9nKGBVcGxvYWRpbmcgcGhvdG8gJHtpICsgMX0vJHtwaG90b3MubGVuZ3Ro\nfTogJHtwaG90by5maWxlbmFtZX1gKTsKICAgICAgICAKICAgICAgICBjb25z\ndCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIC8vIEhhbmRs\nZSBib3RoIGJ1ZmZlciBhbmQgZmlsZSBwYXRoIHNjZW5hcmlvcwogICAgICAg\nIGlmIChwaG90by5idWZmZXIpIHsKICAgICAgICAgIGZvcm1EYXRhLmFwcGVu\nZCgnZmlsZScsIHBob3RvLmJ1ZmZlciwgewogICAgICAgICAgICBmaWxlbmFt\nZTogcGhvdG8uZmlsZW5hbWUsCiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBw\naG90by5taW1ldHlwZQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlm\nIChwaG90by5wYXRoKSB7CiAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2Zp\nbGUnLCBmcy5jcmVhdGVSZWFkU3RyZWFtKHBob3RvLnBhdGgpLCB7CiAgICAg\nICAgICAgIGZpbGVuYW1lOiBwaG90by5maWxlbmFtZSwKICAgICAgICAgICAg\nY29udGVudFR5cGU6IHBob3RvLm1pbWV0eXBlCiAgICAgICAgICB9KTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdXBsb2FkUmVzcG9uc2Ug\nPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwczovL3NlcnZpY2VzLmxlYWRjb25u\nZWN0b3JocS5jb20vbWVkaWFzL3VwbG9hZC1maWxlYCwgZm9ybURhdGEsIHsK\nICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ0F1dGhvcml6YXRp\nb24nOiBgQmVhcmVyICR7aW5zdGFsbGF0aW9uLmFjY2Vzc1Rva2VufWAsCiAg\nICAgICAgICAgICdWZXJzaW9uJzogJzIwMjEtMDctMjgnLAogICAgICAgICAg\nICAuLi5mb3JtRGF0YS5nZXRIZWFkZXJzKCkKICAgICAgICAgIH0sCiAgICAg\nICAgICB0aW1lb3V0OiAzMDAwMAogICAgICAgIH0pOwogICAgICAgIAogICAg\nICAgIHdvcmtmbG93UmVzdWx0LnVwbG9hZGVkUGhvdG9zLnB1c2goewogICAg\nICAgICAgZmlsZW5hbWU6IHBob3RvLmZpbGVuYW1lLAogICAgICAgICAgbWVk\naWFJZDogdXBsb2FkUmVzcG9uc2UuZGF0YS5pZCwKICAgICAgICAgIHVybDog\ndXBsb2FkUmVzcG9uc2UuZGF0YS51cmwsCiAgICAgICAgICBzdWNjZXNzOiB0\ncnVlCiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAgY29uc29sZS5sb2co\nYOKckyBQaG90byAke2kgKyAxfSB1cGxvYWRlZDogJHt1cGxvYWRSZXNwb25z\nZS5kYXRhLmlkfWApOwogICAgICAgIAogICAgICB9IGNhdGNoIChwaG90b0Vy\ncm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihg4pyXIFBob3RvICR7aSAr\nIDF9IHVwbG9hZCBmYWlsZWQ6YCwgcGhvdG9FcnJvci5yZXNwb25zZT8uZGF0\nYSB8fCBwaG90b0Vycm9yLm1lc3NhZ2UpOwogICAgICAgIHdvcmtmbG93UmVz\ndWx0LnVwbG9hZGVkUGhvdG9zLnB1c2goewogICAgICAgICAgZmlsZW5hbWU6\nIHBob3Rvc1tpXS5maWxlbmFtZSwKICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNl\nLAogICAgICAgICAgZXJyb3I6IHBob3RvRXJyb3IucmVzcG9uc2U/LmRhdGEg\nfHwgcGhvdG9FcnJvci5tZXNzYWdlCiAgICAgICAgfSk7CiAgICAgICAgd29y\na2Zsb3dSZXN1bHQuZXJyb3JzLnB1c2goYFBob3RvIHVwbG9hZCBmYWlsZWQ6\nICR7cGhvdG9zW2ldLmZpbGVuYW1lfWApOwogICAgICB9CiAgICB9CiAgICAK\nICAgIC8vIFN0ZXAgMjogQ3JlYXRlIHRoZSBwcm9kdWN0IHdpdGggdXBsb2Fk\nZWQgcGhvdG8gSURzCiAgICBjb25zb2xlLmxvZygnU3RlcCAyOiBDcmVhdGlu\nZyBwcm9kdWN0Li4uJyk7CiAgICAKICAgIGNvbnN0IG1lZGlhSWRzID0gd29y\na2Zsb3dSZXN1bHQudXBsb2FkZWRQaG90b3MKICAgICAgLmZpbHRlcihwaG90\nbyA9PiBwaG90by5zdWNjZXNzKQogICAgICAubWFwKHBob3RvID0+IHBob3Rv\nLm1lZGlhSWQpOwogICAgCiAgICBjb25zdCBwcm9kdWN0RGF0YSA9IHsKICAg\nICAgbmFtZSwKICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uIHx8ICcn\nLAogICAgICB0eXBlOiBwcm9kdWN0VHlwZSB8fCAnUEhZU0lDQUwnLCAvLyBV\nc2UgJ3R5cGUnIGZvciBHb0hpZ2hMZXZlbCBBUEkKICAgICAgbG9jYXRpb25J\nZDogaW5zdGFsbGF0aW9uLmxvY2F0aW9uSWQsCiAgICAgIG1lZGlhSWRzOiBt\nZWRpYUlkcywgLy8gQXR0YWNoIHVwbG9hZGVkIHBob3RvcwogICAgICAuLi4o\nc2t1ICYmIHsgc2t1IH0pLAogICAgICAuLi4oY3VycmVuY3kgJiYgeyBjdXJy\nZW5jeSB9KQogICAgfTsKICAgIAogICAgY29uc29sZS5sb2coYENyZWF0aW5n\nIHByb2R1Y3Qgd2l0aCAke21lZGlhSWRzLmxlbmd0aH0gYXR0YWNoZWQgcGhv\ndG9zYCk7CiAgICAKICAgIGNvbnN0IHByb2R1Y3RSZXNwb25zZSA9IGF3YWl0\nIGF4aW9zLnBvc3QoJ2h0dHBzOi8vc2VydmljZXMubGVhZGNvbm5lY3Rvcmhx\nLmNvbS9wcm9kdWN0cy8nLCBwcm9kdWN0RGF0YSwgewogICAgICBoZWFkZXJz\nOiB7CiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aW5zdGFs\nbGF0aW9uLmFjY2Vzc1Rva2VufWAsCiAgICAgICAgJ1ZlcnNpb24nOiAnMjAy\nMS0wNy0yOCcsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlv\nbi9qc29uJwogICAgICB9LAogICAgICB0aW1lb3V0OiAzMDAwMAogICAgfSk7\nCiAgICAKICAgIHdvcmtmbG93UmVzdWx0LnByb2R1Y3QgPSBwcm9kdWN0UmVz\ncG9uc2UuZGF0YTsKICAgIGNvbnNvbGUubG9nKGDinJMgUHJvZHVjdCBjcmVh\ndGVkOiAke3Byb2R1Y3RSZXNwb25zZS5kYXRhLmlkfWApOwogICAgCiAgICAv\nLyBTdGVwIDM6IEFkZCBtdWx0aXBsZSBwcmljaW5nIHRpZXJzCiAgICBjb25z\nb2xlLmxvZygnU3RlcCAzOiBBZGRpbmcgcHJpY2luZyB0aWVycy4uLicpOwog\nICAgCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHByaWNpbmcubGVuZ3RoOyBp\nKyspIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwcmljZSA9IHByaWNp\nbmdbaV07CiAgICAgICAgY29uc29sZS5sb2coYEFkZGluZyBwcmljZSAke2kg\nKyAxfS8ke3ByaWNpbmcubGVuZ3RofTogJHtwcmljZS5uYW1lfWApOwogICAg\nICAgIAogICAgICAgIGNvbnN0IHByaWNlRGF0YSA9IHsKICAgICAgICAgIG5h\nbWU6IHByaWNlLm5hbWUsCiAgICAgICAgICB0eXBlOiBwcmljZS50eXBlIHx8\nICdvbmVfdGltZScsCiAgICAgICAgICBhbW91bnQ6IHBhcnNlSW50KHByaWNl\nLmFtb3VudCksCiAgICAgICAgICBjdXJyZW5jeTogcHJpY2UuY3VycmVuY3kg\nfHwgJ1VTRCcKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IHBy\naWNlUmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KGBodHRwczovL3NlcnZp\nY2VzLmxlYWRjb25uZWN0b3JocS5jb20vcHJvZHVjdHMvJHtwcm9kdWN0UmVz\ncG9uc2UuZGF0YS5pZH0vcHJpY2VzYCwgcHJpY2VEYXRhLCB7CiAgICAgICAg\nICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYEJl\nYXJlciAke2luc3RhbGxhdGlvbi5hY2Nlc3NUb2tlbn1gLAogICAgICAgICAg\nICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywKICAgICAgICAgICAgJ0NvbnRl\nbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICAgICAgfSwKICAg\nICAgICAgIHRpbWVvdXQ6IDMwMDAwCiAgICAgICAgfSk7CiAgICAgICAgCiAg\nICAgICAgd29ya2Zsb3dSZXN1bHQuY3JlYXRlZFByaWNlcy5wdXNoKHsKICAg\nICAgICAgIG5hbWU6IHByaWNlLm5hbWUsCiAgICAgICAgICBwcmljZUlkOiBw\ncmljZVJlc3BvbnNlLmRhdGEuaWQsCiAgICAgICAgICBhbW91bnQ6IHByaWNl\nLmFtb3VudCwKICAgICAgICAgIHR5cGU6IHByaWNlLnR5cGUsCiAgICAgICAg\nICBzdWNjZXNzOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgCiAgICAgICAg\nY29uc29sZS5sb2coYOKckyBQcmljZSAke2kgKyAxfSBjcmVhdGVkOiAke3By\naWNlUmVzcG9uc2UuZGF0YS5pZH1gKTsKICAgICAgICAKICAgICAgfSBjYXRj\naCAocHJpY2VFcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYOKclyBQ\ncmljZSAke2kgKyAxfSBjcmVhdGlvbiBmYWlsZWQ6YCwgcHJpY2VFcnJvci5y\nZXNwb25zZT8uZGF0YSB8fCBwcmljZUVycm9yLm1lc3NhZ2UpOwogICAgICAg\nIHdvcmtmbG93UmVzdWx0LmNyZWF0ZWRQcmljZXMucHVzaCh7CiAgICAgICAg\nICBuYW1lOiBwcmljaW5nW2ldLm5hbWUsCiAgICAgICAgICBzdWNjZXNzOiBm\nYWxzZSwKICAgICAgICAgIGVycm9yOiBwcmljZUVycm9yLnJlc3BvbnNlPy5k\nYXRhIHx8IHByaWNlRXJyb3IubWVzc2FnZQogICAgICAgIH0pOwogICAgICAg\nIHdvcmtmbG93UmVzdWx0LmVycm9ycy5wdXNoKGBQcmljZSBjcmVhdGlvbiBm\nYWlsZWQ6ICR7cHJpY2luZ1tpXS5uYW1lfWApOwogICAgICB9CiAgICB9CiAg\nICAKICAgIC8vIFdvcmtmbG93IGNvbXBsZXRpb24gc3VtbWFyeQogICAgY29u\nc3Qgc3VtbWFyeSA9IHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgcHJv\nZHVjdElkOiB3b3JrZmxvd1Jlc3VsdC5wcm9kdWN0Py5pZCwKICAgICAgcHJv\nZHVjdE5hbWU6IHdvcmtmbG93UmVzdWx0LnByb2R1Y3Q/Lm5hbWUsCiAgICAg\nIHBob3Rvc1VwbG9hZGVkOiB3b3JrZmxvd1Jlc3VsdC51cGxvYWRlZFBob3Rv\ncy5maWx0ZXIocCA9PiBwLnN1Y2Nlc3MpLmxlbmd0aCwKICAgICAgcHJpY2Vz\nQ3JlYXRlZDogd29ya2Zsb3dSZXN1bHQuY3JlYXRlZFByaWNlcy5maWx0ZXIo\ncCA9PiBwLnN1Y2Nlc3MpLmxlbmd0aCwKICAgICAgdG90YWxFcnJvcnM6IHdv\ncmtmbG93UmVzdWx0LmVycm9ycy5sZW5ndGgKICAgIH07CiAgICAKICAgIGNv\nbnNvbGUubG9nKCc9PT0gV09SS0ZMT1cgQ09NUExFVEUgPT09Jyk7CiAgICBj\nb25zb2xlLmxvZyhgUHJvZHVjdDogJHtzdW1tYXJ5LnByb2R1Y3ROYW1lfSAo\nJHtzdW1tYXJ5LnByb2R1Y3RJZH0pYCk7CiAgICBjb25zb2xlLmxvZyhgUGhv\ndG9zOiAke3N1bW1hcnkucGhvdG9zVXBsb2FkZWR9LyR7cGhvdG9zLmxlbmd0\naH0gdXBsb2FkZWRgKTsKICAgIGNvbnNvbGUubG9nKGBQcmljZXM6ICR7c3Vt\nbWFyeS5wcmljZXNDcmVhdGVkfS8ke3ByaWNpbmcubGVuZ3RofSBjcmVhdGVk\nYCk7CiAgICBjb25zb2xlLmxvZyhgRXJyb3JzOiAke3N1bW1hcnkudG90YWxF\ncnJvcnN9YCk7CiAgICAKICAgIHJlcy5qc29uKHsKICAgICAgc3VjY2Vzczog\ndHJ1ZSwKICAgICAgc3VtbWFyeSwKICAgICAgZGV0YWlsczogd29ya2Zsb3dS\nZXN1bHQsCiAgICAgIG1lc3NhZ2U6ICdDb21wbGV0ZSBwcm9kdWN0IHdvcmtm\nbG93IGV4ZWN1dGVkJwogICAgfSk7CiAgICAKICB9IGNhdGNoIChlcnJvcikg\newogICAgY29uc29sZS5lcnJvcignQ29tcGxldGUgd29ya2Zsb3cgZXJyb3I6\nJywgZXJyb3IucmVzcG9uc2U/LmRhdGEgfHwgZXJyb3IubWVzc2FnZSk7CiAg\nICByZXMuc3RhdHVzKDUwMCkuanNvbih7CiAgICAgIHN1Y2Nlc3M6IGZhbHNl\nLAogICAgICBlcnJvcjogZXJyb3IucmVzcG9uc2U/LmRhdGEgfHwgZXJyb3Iu\nbWVzc2FnZSwKICAgICAgbWVzc2FnZTogJ0NvbXBsZXRlIHByb2R1Y3Qgd29y\na2Zsb3cgZmFpbGVkJwogICAgfSk7CiAgfQp9KTsKCi8vIE11bHRpLXBob3Rv\nIHVwbG9hZCBlbmRwb2ludCAoc3RhbmRhbG9uZSkKYXBwLnBvc3QoJy9hcGkv\ncGhvdG9zL3VwbG9hZC1tdWx0aXBsZScsIHVwbG9hZC5hcnJheSgncGhvdG9z\nJywgMTApLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zb2xlLmxvZygn\nPT09IE1VTFRJUExFIFBIT1RPIFVQTE9BRCA9PT0nKTsKICAKICB0cnkgewog\nICAgY29uc3QgeyBpbnN0YWxsYXRpb25faWQgfSA9IHJlcS5ib2R5OwogICAg\nCiAgICBpZiAoIWluc3RhbGxhdGlvbl9pZCkgewogICAgICByZXR1cm4gcmVz\nLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdp\nbnN0YWxsYXRpb25faWQgcmVxdWlyZWQnIH0pOwogICAgfQogICAgCiAgICBp\nZiAoIXJlcS5maWxlcyB8fCByZXEuZmlsZXMubGVuZ3RoID09PSAwKSB7CiAg\nICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZh\nbHNlLCBlcnJvcjogJ05vIHBob3RvcyBwcm92aWRlZCcgfSk7CiAgICB9CiAg\nICAKICAgIGNvbnNvbGUubG9nKGBVcGxvYWRpbmcgJHtyZXEuZmlsZXMubGVu\nZ3RofSBwaG90b3NgKTsKICAgIAogICAgYXdhaXQgZW5zdXJlRnJlc2hUb2tl\nbihpbnN0YWxsYXRpb25faWQpOwogICAgY29uc3QgaW5zdGFsbGF0aW9uID0g\naW5zdGFsbGF0aW9ucy5nZXQoaW5zdGFsbGF0aW9uX2lkKTsKICAgIAogICAg\nY29uc3QgdXBsb2FkUmVzdWx0cyA9IFtdOwogICAgCiAgICBmb3IgKGxldCBp\nID0gMDsgaSA8IHJlcS5maWxlcy5sZW5ndGg7IGkrKykgewogICAgICB0cnkg\newogICAgICAgIGNvbnN0IGZpbGUgPSByZXEuZmlsZXNbaV07CiAgICAgICAg\nY29uc29sZS5sb2coYFVwbG9hZGluZyBwaG90byAke2kgKyAxfS8ke3JlcS5m\naWxlcy5sZW5ndGh9OiAke2ZpbGUub3JpZ2luYWxuYW1lfWApOwogICAgICAg\nIAogICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAg\nICAgICAgZm9ybURhdGEuYXBwZW5kKCdmaWxlJywgZnMuY3JlYXRlUmVhZFN0\ncmVhbShmaWxlLnBhdGgpLCB7CiAgICAgICAgICBmaWxlbmFtZTogZmlsZS5v\ncmlnaW5hbG5hbWUsCiAgICAgICAgICBjb250ZW50VHlwZTogZmlsZS5taW1l\ndHlwZQogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGNvbnN0IHVwbG9h\nZFJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChgaHR0cHM6Ly9zZXJ2aWNl\ncy5sZWFkY29ubmVjdG9yaHEuY29tL21lZGlhcy91cGxvYWQtZmlsZWAsIGZv\ncm1EYXRhLCB7CiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdB\ndXRob3JpemF0aW9uJzogYEJlYXJlciAke2luc3RhbGxhdGlvbi5hY2Nlc3NU\nb2tlbn1gLAogICAgICAgICAgICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywK\nICAgICAgICAgICAgLi4uZm9ybURhdGEuZ2V0SGVhZGVycygpCiAgICAgICAg\nICB9LAogICAgICAgICAgdGltZW91dDogMzAwMDAKICAgICAgICB9KTsKICAg\nICAgICAKICAgICAgICB1cGxvYWRSZXN1bHRzLnB1c2goewogICAgICAgICAg\nZmlsZW5hbWU6IGZpbGUub3JpZ2luYWxuYW1lLAogICAgICAgICAgbWVkaWFJ\nZDogdXBsb2FkUmVzcG9uc2UuZGF0YS5pZCwKICAgICAgICAgIHVybDogdXBs\nb2FkUmVzcG9uc2UuZGF0YS51cmwsCiAgICAgICAgICBzaXplOiBmaWxlLnNp\nemUsCiAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgfSk7CiAgICAg\nICAgCiAgICAgICAgY29uc29sZS5sb2coYOKckyBQaG90byB1cGxvYWRlZDog\nJHt1cGxvYWRSZXNwb25zZS5kYXRhLmlkfWApOwogICAgICAgIAogICAgICAg\nIC8vIENsZWFuIHVwIHRlbXAgZmlsZQogICAgICAgIGZzLnVubGlua1N5bmMo\nZmlsZS5wYXRoKTsKICAgICAgICAKICAgICAgfSBjYXRjaCAodXBsb2FkRXJy\nb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGDinJcgUGhvdG8gdXBsb2Fk\nIGZhaWxlZDpgLCB1cGxvYWRFcnJvci5yZXNwb25zZT8uZGF0YSB8fCB1cGxv\nYWRFcnJvci5tZXNzYWdlKTsKICAgICAgICB1cGxvYWRSZXN1bHRzLnB1c2go\newogICAgICAgICAgZmlsZW5hbWU6IHJlcS5maWxlc1tpXS5vcmlnaW5hbG5h\nbWUsCiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwKICAgICAgICAgIGVycm9y\nOiB1cGxvYWRFcnJvci5yZXNwb25zZT8uZGF0YSB8fCB1cGxvYWRFcnJvci5t\nZXNzYWdlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIAogICAgY29u\nc3Qgc3VjY2Vzc0NvdW50ID0gdXBsb2FkUmVzdWx0cy5maWx0ZXIociA9PiBy\nLnN1Y2Nlc3MpLmxlbmd0aDsKICAgIAogICAgcmVzLmpzb24oewogICAgICBz\ndWNjZXNzOiB0cnVlLAogICAgICB0b3RhbFVwbG9hZGVkOiBzdWNjZXNzQ291\nbnQsCiAgICAgIHRvdGFsRmlsZXM6IHJlcS5maWxlcy5sZW5ndGgsCiAgICAg\nIHVwbG9hZHM6IHVwbG9hZFJlc3VsdHMsCiAgICAgIG1lZGlhSWRzOiB1cGxv\nYWRSZXN1bHRzLmZpbHRlcihyID0+IHIuc3VjY2VzcykubWFwKHIgPT4gci5t\nZWRpYUlkKQogICAgfSk7CiAgICAKICB9IGNhdGNoIChlcnJvcikgewogICAg\nY29uc29sZS5lcnJvcignTXVsdGlwbGUgcGhvdG8gdXBsb2FkIGVycm9yOics\nIGVycm9yLnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yLm1lc3NhZ2UpOwogICAg\ncmVzLnN0YXR1cyg1MDApLmpzb24oewogICAgICBzdWNjZXNzOiBmYWxzZSwK\nICAgICAgZXJyb3I6IGVycm9yLnJlc3BvbnNlPy5kYXRhIHx8IGVycm9yLm1l\nc3NhZ2UsCiAgICAgIG1lc3NhZ2U6ICdNdWx0aXBsZSBwaG90byB1cGxvYWQg\nZmFpbGVkJwogICAgfSk7CiAgfQp9KTsKCi8vIEVOSEFOQ0VEIFBST0RVQ1Qg\nV09SS0ZMT1dTCgovLyBDcmVhdGUgcHJvZHVjdCB3aXRoIGNvbGxlY3Rpb24g\nYXNzaWdubWVudAphcHAucG9zdCgnL2FwaS9wcm9kdWN0cy9jcmVhdGUtd2l0\naC1jb2xsZWN0aW9uJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc29s\nZS5sb2coJz09PSBQUk9EVUNUICsgQ09MTEVDVElPTiBXT1JLRkxPVyA9PT0n\nKTsKICAKICB0cnkgewogICAgY29uc3QgeyAKICAgICAgbmFtZSwgCiAgICAg\nIGRlc2NyaXB0aW9uLCAKICAgICAgcHJvZHVjdFR5cGUsIAogICAgICBza3Us\nIAogICAgICBjdXJyZW5jeSwgCiAgICAgIGNvbGxlY3Rpb25JZCwKICAgICAg\ncHJpY2luZyA9IFtdLAogICAgICBtZWRpYUlkcyA9IFtdLAogICAgICBpbnN0\nYWxsYXRpb25faWQgCiAgICB9ID0gcmVxLmJvZHk7CiAgICAKICAgIGlmICgh\naW5zdGFsbGF0aW9uX2lkKSB7CiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQw\nMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ2luc3RhbGxhdGlv\nbl9pZCByZXF1aXJlZCcgfSk7CiAgICB9CiAgICAKICAgIGlmICghbmFtZSkg\newogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNz\nOiBmYWxzZSwgZXJyb3I6ICdwcm9kdWN0IG5hbWUgcmVxdWlyZWQnIH0pOwog\nICAgfQogICAgCiAgICBjb25zb2xlLmxvZyhgQ3JlYXRpbmcgcHJvZHVjdCB3\naXRoIGNvbGxlY3Rpb24gYXNzaWdubWVudDogJHtuYW1lfWApOwogICAgCiAg\nICBhd2FpdCBlbnN1cmVGcmVzaFRva2VuKGluc3RhbGxhdGlvbl9pZCk7CiAg\nICBjb25zdCBpbnN0YWxsYXRpb24gPSBpbnN0YWxsYXRpb25zLmdldChpbnN0\nYWxsYXRpb25faWQpOwogICAgCiAgICAvLyBTdGVwIDE6IENyZWF0ZSB0aGUg\ncHJvZHVjdAogICAgY29uc3QgcHJvZHVjdERhdGEgPSB7CiAgICAgIG5hbWUs\nCiAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB8fCAnJywKICAgICAg\ncHJvZHVjdFR5cGU6IHByb2R1Y3RUeXBlIHx8ICdwcm9kdWN0JywKICAgICAg\nc2t1OiBza3UgfHwgJycsCiAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSB8fCAn\nVVNEJywKICAgICAgbG9jYXRpb25JZDogaW5zdGFsbGF0aW9uLmxvY2F0aW9u\nSWQsCiAgICAgIG1lZGlhSWRzOiBtZWRpYUlkcwogICAgfTsKICAgIAogICAg\nY29uc3QgcHJvZHVjdFJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCgnaHR0\ncHM6Ly9zZXJ2aWNlcy5sZWFkY29ubmVjdG9yaHEuY29tL3Byb2R1Y3RzLycs\nIHByb2R1Y3REYXRhLCB7CiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnQXV0\naG9yaXphdGlvbic6IGBCZWFyZXIgJHtpbnN0YWxsYXRpb24uYWNjZXNzVG9r\nZW59YCwKICAgICAgICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywKICAgICAg\nICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgIH0K\nICAgIH0pOwogICAgCiAgICBjb25zdCBjcmVhdGVkUHJvZHVjdCA9IHByb2R1\nY3RSZXNwb25zZS5kYXRhOwogICAgY29uc29sZS5sb2coJ1Byb2R1Y3QgY3Jl\nYXRlZDonLCBjcmVhdGVkUHJvZHVjdC5pZCk7CiAgICAKICAgIC8vIFN0ZXAg\nMjogQWRkIHByaWNpbmcgaWYgcHJvdmlkZWQKICAgIGNvbnN0IGNyZWF0ZWRQ\ncmljZXMgPSBbXTsKICAgIGlmIChwcmljaW5nLmxlbmd0aCA+IDApIHsKICAg\nICAgZm9yIChjb25zdCBwcmljZSBvZiBwcmljaW5nKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgIGNvbnN0IHByaWNlUmVzcG9uc2UgPSBhd2FpdCBheGlv\ncy5wb3N0KGBodHRwczovL3NlcnZpY2VzLmxlYWRjb25uZWN0b3JocS5jb20v\ncHJvZHVjdHMvJHtjcmVhdGVkUHJvZHVjdC5pZH0vcHJpY2VzYCwgewogICAg\nICAgICAgICBuYW1lOiBwcmljZS5uYW1lLAogICAgICAgICAgICB0eXBlOiBw\ncmljZS50eXBlIHx8ICdvbmVfdGltZScsCiAgICAgICAgICAgIGFtb3VudDog\ncGFyc2VJbnQocHJpY2UuYW1vdW50KSwKICAgICAgICAgICAgY3VycmVuY3k6\nIHByaWNlLmN1cnJlbmN5IHx8ICdVU0QnCiAgICAgICAgICB9LCB7CiAgICAg\nICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAnQXV0aG9yaXphdGlv\nbic6IGBCZWFyZXIgJHtpbnN0YWxsYXRpb24uYWNjZXNzVG9rZW59YCwKICAg\nICAgICAgICAgICAnVmVyc2lvbic6ICcyMDIxLTA3LTI4JywKICAgICAgICAg\nICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAg\nICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgY3JlYXRlZFByaWNl\ncy5wdXNoKHByaWNlUmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICBjb25zb2xl\nLmxvZygnUHJpY2UgY3JlYXRlZDonLCBwcmljZVJlc3BvbnNlLmRhdGEuaWQp\nOwogICAgICAgIH0gY2F0Y2ggKHByaWNlRXJyb3IpIHsKICAgICAgICAgIGNv\nbnNvbGUuZXJyb3IoJ1ByaWNlIGNyZWF0aW9uIGZhaWxlZDonLCBwcmljZUVy\ncm9yLnJlc3BvbnNlPy5kYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0K\nICAgIAogICAgLy8gU3RlcCAzOiBBZGQgdG8gY29sbGVjdGlvbiBpZiBzcGVj\naWZpZWQKICAgIGxldCBjb2xsZWN0aW9uVXBkYXRlID0gbnVsbDsKICAgIGlm\nIChjb2xsZWN0aW9uSWQpIHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCB1\ncGRhdGVSZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBhdGNoKGBodHRwczovL3Nl\ncnZpY2VzLmxlYWRjb25uZWN0b3JocS5jb20vY29sbGVjdGlvbnMvJHtjb2xs\nZWN0aW9uSWR9YCwgewogICAgICAgICAgcHJvZHVjdElkczogW2NyZWF0ZWRQ\ncm9kdWN0LmlkXQogICAgICAgIH0sIHsKICAgICAgICAgIGhlYWRlcnM6IHsK\nICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aW5zdGFs\nbGF0aW9uLmFjY2Vzc1Rva2VufWAsCiAgICAgICAgICAgICdWZXJzaW9uJzog\nJzIwMjEtMDctMjgnLAogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2Fw\ncGxpY2F0aW9uL2pzb24nCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAg\nICAgY29sbGVjdGlvblVwZGF0ZSA9IHVwZGF0ZVJlc3BvbnNlLmRhdGE7CiAg\nICAgICAgY29uc29sZS5sb2coJ1Byb2R1Y3QgYWRkZWQgdG8gY29sbGVjdGlv\nbjonLCBjb2xsZWN0aW9uSWQpOwogICAgICB9IGNhdGNoIChjb2xsZWN0aW9u\nRXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdDb2xsZWN0aW9uIHVw\nZGF0ZSBmYWlsZWQ6JywgY29sbGVjdGlvbkVycm9yLnJlc3BvbnNlPy5kYXRh\nKTsKICAgICAgfQogICAgfQogICAgCiAgICByZXMuanNvbih7CiAgICAgIHN1\nY2Nlc3M6IHRydWUsCiAgICAgIHByb2R1Y3Q6IGNyZWF0ZWRQcm9kdWN0LAog\nICAgICBwcmljZXM6IGNyZWF0ZWRQcmljZXMsCiAgICAgIGNvbGxlY3Rpb246\nIGNvbGxlY3Rpb25VcGRhdGUsCiAgICAgIG1lc3NhZ2U6ICdQcm9kdWN0IGNy\nZWF0ZWQgd2l0aCBmdWxsIHdvcmtmbG93JwogICAgfSk7CiAgICAKICB9IGNh\ndGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcignUHJvZHVjdCB3b3Jr\nZmxvdyBlcnJvcjonLCBlcnJvci5yZXNwb25zZT8uZGF0YSB8fCBlcnJvci5t\nZXNzYWdlKTsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsKICAgICAgc3Vj\nY2VzczogZmFsc2UsCiAgICAgIGVycm9yOiBlcnJvci5yZXNwb25zZT8uZGF0\nYSB8fCBlcnJvci5tZXNzYWdlLAogICAgICBtZXNzYWdlOiAnRmFpbGVkIHRv\nIGNyZWF0ZSBwcm9kdWN0IHdpdGggd29ya2Zsb3cnCiAgICB9KTsKICB9Cn0p\nOwoKLy8gVE9LRU4gVEVTVCBFTkRQT0lOVAphcHAuZ2V0KCcvYXBpL3Rlc3Qv\ndG9rZW4nLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zb2xlLmxvZygn\nPT09IFRPS0VOIFRFU1QgUkVRVUVTVCA9PT0nKTsKICAKICB0cnkgewogICAg\nY29uc3QgeyBpbnN0YWxsYXRpb25faWQgfSA9IHJlcS5xdWVyeTsKICAgIAog\nICAgaWYgKCFpbnN0YWxsYXRpb25faWQpIHsKICAgICAgcmV0dXJuIHJlcy5z\ndGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnaW5z\ndGFsbGF0aW9uX2lkIHJlcXVpcmVkJyB9KTsKICAgIH0KICAgIAogICAgYXdh\naXQgZW5zdXJlRnJlc2hUb2tlbihpbnN0YWxsYXRpb25faWQpOwogICAgY29u\nc3QgaW5zdGFsbGF0aW9uID0gaW5zdGFsbGF0aW9ucy5nZXQoaW5zdGFsbGF0\naW9uX2lkKTsKICAgIAogICAgY29uc29sZS5sb2coJ1Rlc3RpbmcgdG9rZW4g\nd2l0aCBsb2NhdGlvbiBpbmZvIHJlcXVlc3QuLi4nKTsKICAgIAogICAgLy8g\nVGVzdCB3aXRoIGEgc2ltcGxlIGxvY2F0aW9uIGluZm8gcmVxdWVzdAogICAg\nY29uc3QgdGVzdFJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KGBodHRwczov\nL3NlcnZpY2VzLmxlYWRjb25uZWN0b3JocS5jb20vbG9jYXRpb25zLyR7aW5z\ndGFsbGF0aW9uLmxvY2F0aW9uSWR9YCwgewogICAgICBoZWFkZXJzOiB7CiAg\nICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7aW5zdGFsbGF0aW9u\nLmFjY2Vzc1Rva2VufWAsCiAgICAgICAgJ1ZlcnNpb24nOiAnMjAyMS0wNy0y\nOCcKICAgICAgfQogICAgfSk7CiAgICAKICAgIGNvbnNvbGUubG9nKCdUb2tl\nbiB0ZXN0IHN1Y2Nlc3NmdWw6JywgdGVzdFJlc3BvbnNlLnN0YXR1cyk7CiAg\nICAKICAgIHJlcy5qc29uKHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAg\ndG9rZW5TdGF0dXM6ICd2YWxpZCcsCiAgICAgIGxvY2F0aW9uSWQ6IGluc3Rh\nbGxhdGlvbi5sb2NhdGlvbklkLAogICAgICBzY29wZXM6IGluc3RhbGxhdGlv\nbi5zY29wZXMsCiAgICAgIGxvY2F0aW9uRGF0YTogdGVzdFJlc3BvbnNlLmRh\ndGEKICAgIH0pOwogICAgCiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNv\nbGUuZXJyb3IoJ1Rva2VuIHRlc3QgZXJyb3I6JywgZXJyb3IucmVzcG9uc2U/\nLmRhdGEgfHwgZXJyb3IubWVzc2FnZSk7CiAgICBjb25zb2xlLmVycm9yKCdF\ncnJvciBzdGF0dXM6JywgZXJyb3IucmVzcG9uc2U/LnN0YXR1cyk7CiAgICBy\nZXMuc3RhdHVzKDUwMCkuanNvbih7CiAgICAgIHN1Y2Nlc3M6IGZhbHNlLAog\nICAgICBlcnJvcjogZXJyb3IucmVzcG9uc2U/LmRhdGEgfHwgZXJyb3IubWVz\nc2FnZSwKICAgICAgc3RhdHVzOiBlcnJvci5yZXNwb25zZT8uc3RhdHVzLAog\nICAgICBtZXNzYWdlOiAnVG9rZW4gdGVzdCBmYWlsZWQnCiAgICB9KTsKICB9\nCn0pOwoKLy8gQ1VTVE9NRVIgU1VQUE9SVCBFTkRQT0lOVFMKCi8vIENyZWF0\nZSBzdXBwb3J0IHRpY2tldAphcHAucG9zdCgnL2FwaS9zdXBwb3J0L3RpY2tl\ndHMnLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zb2xlLmxvZygnPT09\nIFNVUFBPUlQgVElDS0VUIENSRUFUSU9OID09PScpOwogIAogIHRyeSB7CiAg\nICBjb25zdCB7IAogICAgICBjdXN0b21lckVtYWlsLCAKICAgICAgY3VzdG9t\nZXJOYW1lLAogICAgICBzdWJqZWN0LCAKICAgICAgZGVzY3JpcHRpb24sIAog\nICAgICBwcmlvcml0eSA9ICdtZWRpdW0nLAogICAgICBjYXRlZ29yeSA9ICdn\nZW5lcmFsJywKICAgICAgaW5zdGFsbGF0aW9uSWQgCiAgICB9ID0gcmVxLmJv\nZHk7CiAgICAKICAgIGlmICghY3VzdG9tZXJFbWFpbCB8fCAhc3ViamVjdCB8\nfCAhZGVzY3JpcHRpb24pIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAw\nKS5qc29uKHsgCiAgICAgICAgc3VjY2VzczogZmFsc2UsIAogICAgICAgIGVy\ncm9yOiAnY3VzdG9tZXJFbWFpbCwgc3ViamVjdCwgYW5kIGRlc2NyaXB0aW9u\nIGFyZSByZXF1aXJlZCcgCiAgICAgIH0pOwogICAgfQogICAgCiAgICBjb25z\ndCB0aWNrZXRJZCA9ICd0aWNrZXRfJyArIERhdGUubm93KCk7CiAgICBjb25z\ndCB0aWNrZXQgPSB7CiAgICAgIGlkOiB0aWNrZXRJZCwKICAgICAgY3VzdG9t\nZXJFbWFpbCwKICAgICAgY3VzdG9tZXJOYW1lOiBjdXN0b21lck5hbWUgfHwg\nJ1Vua25vd24nLAogICAgICBzdWJqZWN0LAogICAgICBkZXNjcmlwdGlvbiwK\nICAgICAgcHJpb3JpdHksIC8vIGxvdywgbWVkaXVtLCBoaWdoLCB1cmdlbnQK\nICAgICAgY2F0ZWdvcnksIC8vIGdlbmVyYWwsIHRlY2huaWNhbCwgYmlsbGlu\nZywgZmVhdHVyZV9yZXF1ZXN0CiAgICAgIHN0YXR1czogJ29wZW4nLCAvLyBv\ncGVuLCBpbl9wcm9ncmVzcywgd2FpdGluZ19jdXN0b21lciwgcmVzb2x2ZWQs\nIGNsb3NlZAogICAgICBpbnN0YWxsYXRpb25JZCwKICAgICAgY3JlYXRlZEF0\nOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgIHVwZGF0ZWRBdDog\nbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICBtZXNzYWdlczogW3sK\nICAgICAgICBpZDogJ21zZ18nICsgRGF0ZS5ub3coKSwKICAgICAgICBmcm9t\nOiAnY3VzdG9tZXInLAogICAgICAgIGNvbnRlbnQ6IGRlc2NyaXB0aW9uLAog\nICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAg\nICAgIH1dLAogICAgICBhc3NpZ25lZFRvOiBudWxsLAogICAgICB0YWdzOiBb\nXSwKICAgICAgc2F0aXNmYWN0aW9uOiBudWxsCiAgICB9OwogICAgCiAgICBz\ndXBwb3J0VGlja2V0cy5zZXQodGlja2V0SWQsIHRpY2tldCk7CiAgICBzdXBw\nb3J0TWV0cmljcy50b3RhbFRpY2tldHMrKzsKICAgIAogICAgY29uc29sZS5s\nb2coYFN1cHBvcnQgdGlja2V0IGNyZWF0ZWQ6ICR7dGlja2V0SWR9YCk7CiAg\nICAKICAgIHJlcy5qc29uKHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAg\ndGlja2V0LAogICAgICBtZXNzYWdlOiAnU3VwcG9ydCB0aWNrZXQgY3JlYXRl\nZCBzdWNjZXNzZnVsbHknCiAgICB9KTsKICAgIAogIH0gY2F0Y2ggKGVycm9y\nKSB7CiAgICBjb25zb2xlLmVycm9yKCdTdXBwb3J0IHRpY2tldCBjcmVhdGlv\nbiBlcnJvcjonLCBlcnJvci5tZXNzYWdlKTsKICAgIHJlcy5zdGF0dXMoNTAw\nKS5qc29uKHsKICAgICAgc3VjY2VzczogZmFsc2UsCiAgICAgIGVycm9yOiBl\ncnJvci5tZXNzYWdlLAogICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0\nZSBzdXBwb3J0IHRpY2tldCcKICAgIH0pOwogIH0KfSk7CgovLyBHZXQgc3Vw\ncG9ydCB0aWNrZXRzIChhZG1pbiB2aWV3KQphcHAuZ2V0KCcvYXBpL3N1cHBv\ncnQvdGlja2V0cycsIChyZXEsIHJlcykgPT4gewogIHRyeSB7CiAgICBjb25z\ndCB7IHN0YXR1cywgcHJpb3JpdHksIGNhdGVnb3J5LCBjdXN0b21lckVtYWls\nIH0gPSByZXEucXVlcnk7CiAgICBsZXQgdGlja2V0cyA9IEFycmF5LmZyb20o\nc3VwcG9ydFRpY2tldHMudmFsdWVzKCkpOwogICAgCiAgICAvLyBBcHBseSBm\naWx0ZXJzCiAgICBpZiAoc3RhdHVzKSB0aWNrZXRzID0gdGlja2V0cy5maWx0\nZXIodCA9PiB0LnN0YXR1cyA9PT0gc3RhdHVzKTsKICAgIGlmIChwcmlvcml0\neSkgdGlja2V0cyA9IHRpY2tldHMuZmlsdGVyKHQgPT4gdC5wcmlvcml0eSA9\nPT0gcHJpb3JpdHkpOwogICAgaWYgKGNhdGVnb3J5KSB0aWNrZXRzID0gdGlj\na2V0cy5maWx0ZXIodCA9PiB0LmNhdGVnb3J5ID09PSBjYXRlZ29yeSk7CiAg\nICBpZiAoY3VzdG9tZXJFbWFpbCkgdGlja2V0cyA9IHRpY2tldHMuZmlsdGVy\nKHQgPT4gdC5jdXN0b21lckVtYWlsID09PSBjdXN0b21lckVtYWlsKTsKICAg\nIAogICAgLy8gU29ydCBieSBjcmVhdGlvbiBkYXRlIChuZXdlc3QgZmlyc3Qp\nCiAgICB0aWNrZXRzLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIuY3JlYXRl\nZEF0KSAtIG5ldyBEYXRlKGEuY3JlYXRlZEF0KSk7CiAgICAKICAgIHJlcy5q\nc29uKHsKICAgICAgc3VjY2VzczogdHJ1ZSwKICAgICAgdGlja2V0cywKICAg\nICAgY291bnQ6IHRpY2tldHMubGVuZ3RoLAogICAgICBtZXRyaWNzOiBzdXBw\nb3J0TWV0cmljcwogICAgfSk7CiAgICAKICB9IGNhdGNoIChlcnJvcikgewog\nICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJy\nb3I6IGVycm9yLm1lc3NhZ2UgfSk7CiAgfQp9KTsKCi8vIEdldCBzcGVjaWZp\nYyB0aWNrZXQKYXBwLmdldCgnL2FwaS9zdXBwb3J0L3RpY2tldHMvOnRpY2tl\ndElkJywgKHJlcSwgcmVzKSA9PiB7CiAgdHJ5IHsKICAgIGNvbnN0IHRpY2tl\ndCA9IHN1cHBvcnRUaWNrZXRzLmdldChyZXEucGFyYW1zLnRpY2tldElkKTsK\nICAgIAogICAgaWYgKCF0aWNrZXQpIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0\ndXMoNDA0KS5qc29uKHsgCiAgICAgICAgc3VjY2VzczogZmFsc2UsIAogICAg\nICAgIGVycm9yOiAnVGlja2V0IG5vdCBmb3VuZCcgCiAgICAgIH0pOwogICAg\nfQogICAgCiAgICByZXMuanNvbih7IHN1Y2Nlc3M6IHRydWUsIHRpY2tldCB9\nKTsKICAgIAogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICByZXMuc3RhdHVzKDUw\nMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2Fn\nZSB9KTsKICB9Cn0pOwoKLy8gVXBkYXRlIHRpY2tldCBzdGF0dXMKYXBwLnBh\ndGNoKCcvYXBpL3N1cHBvcnQvdGlja2V0cy86dGlja2V0SWQnLCAocmVxLCBy\nZXMpID0+IHsKICB0cnkgewogICAgY29uc3QgdGlja2V0ID0gc3VwcG9ydFRp\nY2tldHMuZ2V0KHJlcS5wYXJhbXMudGlja2V0SWQpOwogICAgCiAgICBpZiAo\nIXRpY2tldCkgewogICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24o\neyAKICAgICAgICBzdWNjZXNzOiBmYWxzZSwgCiAgICAgICAgZXJyb3I6ICdU\naWNrZXQgbm90IGZvdW5kJyAKICAgICAgfSk7CiAgICB9CiAgICAKICAgIGNv\nbnN0IHsgc3RhdHVzLCBhc3NpZ25lZFRvLCBwcmlvcml0eSwgdGFncyB9ID0g\ncmVxLmJvZHk7CiAgICAKICAgIGlmIChzdGF0dXMpIHRpY2tldC5zdGF0dXMg\nPSBzdGF0dXM7CiAgICBpZiAoYXNzaWduZWRUbyAhPT0gdW5kZWZpbmVkKSB0\naWNrZXQuYXNzaWduZWRUbyA9IGFzc2lnbmVkVG87CiAgICBpZiAocHJpb3Jp\ndHkpIHRpY2tldC5wcmlvcml0eSA9IHByaW9yaXR5OwogICAgaWYgKHRhZ3Mp\nIHRpY2tldC50YWdzID0gdGFnczsKICAgIAogICAgdGlja2V0LnVwZGF0ZWRB\ndCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICAgIAogICAgLy8gVXBk\nYXRlIG1ldHJpY3MKICAgIGlmIChzdGF0dXMgPT09ICdyZXNvbHZlZCcgfHwg\nc3RhdHVzID09PSAnY2xvc2VkJykgewogICAgICBzdXBwb3J0TWV0cmljcy5y\nZXNvbHZlZFRpY2tldHMrKzsKICAgIH0KICAgIAogICAgc3VwcG9ydFRpY2tl\ndHMuc2V0KHJlcS5wYXJhbXMudGlja2V0SWQsIHRpY2tldCk7CiAgICAKICAg\nIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgdGlja2V0IH0pOwogICAgCiAg\nfSBjYXRjaCAoZXJyb3IpIHsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsg\nc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0pOwogIH0K\nfSk7CgovLyBBZGQgbWVzc2FnZSB0byB0aWNrZXQKYXBwLnBvc3QoJy9hcGkv\nc3VwcG9ydC90aWNrZXRzLzp0aWNrZXRJZC9tZXNzYWdlcycsIChyZXEsIHJl\ncykgPT4gewogIHRyeSB7CiAgICBjb25zdCB0aWNrZXQgPSBzdXBwb3J0VGlj\na2V0cy5nZXQocmVxLnBhcmFtcy50aWNrZXRJZCk7CiAgICAKICAgIGlmICgh\ndGlja2V0KSB7CiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7\nIAogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCAKICAgICAgICBlcnJvcjogJ1Rp\nY2tldCBub3QgZm91bmQnIAogICAgICB9KTsKICAgIH0KICAgIAogICAgY29u\nc3QgeyBjb250ZW50LCBmcm9tID0gJ3N1cHBvcnQnIH0gPSByZXEuYm9keTsK\nICAgIAogICAgaWYgKCFjb250ZW50KSB7CiAgICAgIHJldHVybiByZXMuc3Rh\ndHVzKDQwMCkuanNvbih7IAogICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCAKICAg\nICAgICBlcnJvcjogJ01lc3NhZ2UgY29udGVudCBpcyByZXF1aXJlZCcgCiAg\nICAgIH0pOwogICAgfQogICAgCiAgICBjb25zdCBtZXNzYWdlID0gewogICAg\nICBpZDogJ21zZ18nICsgRGF0ZS5ub3coKSwKICAgICAgZnJvbSwgLy8gJ2N1\nc3RvbWVyJyBvciAnc3VwcG9ydCcKICAgICAgY29udGVudCwKICAgICAgdGlt\nZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgIH07CiAgICAK\nICAgIHRpY2tldC5tZXNzYWdlcy5wdXNoKG1lc3NhZ2UpOwogICAgdGlja2V0\nLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKICAgIAog\nICAgc3VwcG9ydFRpY2tldHMuc2V0KHJlcS5wYXJhbXMudGlja2V0SWQsIHRp\nY2tldCk7CiAgICAKICAgIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSwgbWVz\nc2FnZSwgdGlja2V0IH0pOwogICAgCiAgfSBjYXRjaCAoZXJyb3IpIHsKICAg\nIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9y\nOiBlcnJvci5tZXNzYWdlIH0pOwogIH0KfSk7CgovLyBDdXN0b21lciBzYXRp\nc2ZhY3Rpb24gcmF0aW5nCmFwcC5wb3N0KCcvYXBpL3N1cHBvcnQvdGlja2V0\ncy86dGlja2V0SWQvc2F0aXNmYWN0aW9uJywgKHJlcSwgcmVzKSA9PiB7CiAg\ndHJ5IHsKICAgIGNvbnN0IHRpY2tldCA9IHN1cHBvcnRUaWNrZXRzLmdldChy\nZXEucGFyYW1zLnRpY2tldElkKTsKICAgIAogICAgaWYgKCF0aWNrZXQpIHsK\nICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgCiAgICAgICAg\nc3VjY2VzczogZmFsc2UsIAogICAgICAgIGVycm9yOiAnVGlja2V0IG5vdCBm\nb3VuZCcgCiAgICAgIH0pOwogICAgfQogICAgCiAgICBjb25zdCB7IHJhdGlu\nZywgZmVlZGJhY2sgfSA9IHJlcS5ib2R5OyAvLyByYXRpbmc6IDEtNQogICAg\nCiAgICBpZiAoIXJhdGluZyB8fCByYXRpbmcgPCAxIHx8IHJhdGluZyA+IDUp\nIHsKICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgCiAgICAg\nICAgc3VjY2VzczogZmFsc2UsIAogICAgICAgIGVycm9yOiAnUmF0aW5nIG11\nc3QgYmUgYmV0d2VlbiAxIGFuZCA1JyAKICAgICAgfSk7CiAgICB9CiAgICAK\nICAgIHRpY2tldC5zYXRpc2ZhY3Rpb24gPSB7IHJhdGluZywgZmVlZGJhY2ss\nIHN1Ym1pdHRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfTsKICAg\nIHRpY2tldC51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7\nCiAgICAKICAgIHN1cHBvcnRUaWNrZXRzLnNldChyZXEucGFyYW1zLnRpY2tl\ndElkLCB0aWNrZXQpOwogICAgCiAgICAvLyBVcGRhdGUgYXZlcmFnZSBzYXRp\nc2ZhY3Rpb24KICAgIGNvbnN0IHNhdGlzZmFjdGlvblJhdGluZ3MgPSBBcnJh\neS5mcm9tKHN1cHBvcnRUaWNrZXRzLnZhbHVlcygpKQogICAgICAuZmlsdGVy\nKHQgPT4gdC5zYXRpc2ZhY3Rpb24pCiAgICAgIC5tYXAodCA9PiB0LnNhdGlz\nZmFjdGlvbi5yYXRpbmcpOwogICAgICAKICAgIGlmIChzYXRpc2ZhY3Rpb25S\nYXRpbmdzLmxlbmd0aCA+IDApIHsKICAgICAgc3VwcG9ydE1ldHJpY3MuY3Vz\ndG9tZXJTYXRpc2ZhY3Rpb24gPSAKICAgICAgICBzYXRpc2ZhY3Rpb25SYXRp\nbmdzLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApIC8gc2F0aXNmYWN0aW9u\nUmF0aW5ncy5sZW5ndGg7CiAgICB9CiAgICAKICAgIHJlcy5qc29uKHsgc3Vj\nY2VzczogdHJ1ZSwgdGlja2V0IH0pOwogICAgCiAgfSBjYXRjaCAoZXJyb3Ip\nIHsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2Us\nIGVycm9yOiBlcnJvci5tZXNzYWdlIH0pOwogIH0KfSk7CgovLyBTdXBwb3J0\nIGFuYWx5dGljcyBkYXNoYm9hcmQKYXBwLmdldCgnL2FwaS9zdXBwb3J0L2Fu\nYWx5dGljcycsIChyZXEsIHJlcykgPT4gewogIHRyeSB7CiAgICBjb25zdCB0\naWNrZXRzID0gQXJyYXkuZnJvbShzdXBwb3J0VGlja2V0cy52YWx1ZXMoKSk7\nCiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgY29uc3QgbGFzdDMw\nRGF5cyA9IG5ldyBEYXRlKG5vdyAtIDMwICogMjQgKiA2MCAqIDYwICogMTAw\nMCk7CiAgICAKICAgIGNvbnN0IGFuYWx5dGljcyA9IHsKICAgICAgb3ZlcnZp\nZXc6IHN1cHBvcnRNZXRyaWNzLAogICAgICB0aWNrZXRzQnlTdGF0dXM6IHsK\nICAgICAgICBvcGVuOiB0aWNrZXRzLmZpbHRlcih0ID0+IHQuc3RhdHVzID09\nPSAnb3BlbicpLmxlbmd0aCwKICAgICAgICBpbl9wcm9ncmVzczogdGlja2V0\ncy5maWx0ZXIodCA9PiB0LnN0YXR1cyA9PT0gJ2luX3Byb2dyZXNzJykubGVu\nZ3RoLAogICAgICAgIHdhaXRpbmdfY3VzdG9tZXI6IHRpY2tldHMuZmlsdGVy\nKHQgPT4gdC5zdGF0dXMgPT09ICd3YWl0aW5nX2N1c3RvbWVyJykubGVuZ3Ro\nLAogICAgICAgIHJlc29sdmVkOiB0aWNrZXRzLmZpbHRlcih0ID0+IHQuc3Rh\ndHVzID09PSAncmVzb2x2ZWQnKS5sZW5ndGgsCiAgICAgICAgY2xvc2VkOiB0\naWNrZXRzLmZpbHRlcih0ID0+IHQuc3RhdHVzID09PSAnY2xvc2VkJykubGVu\nZ3RoCiAgICAgIH0sCiAgICAgIHRpY2tldHNCeVByaW9yaXR5OiB7CiAgICAg\nICAgbG93OiB0aWNrZXRzLmZpbHRlcih0ID0+IHQucHJpb3JpdHkgPT09ICds\nb3cnKS5sZW5ndGgsCiAgICAgICAgbWVkaXVtOiB0aWNrZXRzLmZpbHRlcih0\nID0+IHQucHJpb3JpdHkgPT09ICdtZWRpdW0nKS5sZW5ndGgsCiAgICAgICAg\naGlnaDogdGlja2V0cy5maWx0ZXIodCA9PiB0LnByaW9yaXR5ID09PSAnaGln\naCcpLmxlbmd0aCwKICAgICAgICB1cmdlbnQ6IHRpY2tldHMuZmlsdGVyKHQg\nPT4gdC5wcmlvcml0eSA9PT0gJ3VyZ2VudCcpLmxlbmd0aAogICAgICB9LAog\nICAgICB0aWNrZXRzQnlDYXRlZ29yeTogewogICAgICAgIGdlbmVyYWw6IHRp\nY2tldHMuZmlsdGVyKHQgPT4gdC5jYXRlZ29yeSA9PT0gJ2dlbmVyYWwnKS5s\nZW5ndGgsCiAgICAgICAgdGVjaG5pY2FsOiB0aWNrZXRzLmZpbHRlcih0ID0+\nIHQuY2F0ZWdvcnkgPT09ICd0ZWNobmljYWwnKS5sZW5ndGgsCiAgICAgICAg\nYmlsbGluZzogdGlja2V0cy5maWx0ZXIodCA9PiB0LmNhdGVnb3J5ID09PSAn\nYmlsbGluZycpLmxlbmd0aCwKICAgICAgICBmZWF0dXJlX3JlcXVlc3Q6IHRp\nY2tldHMuZmlsdGVyKHQgPT4gdC5jYXRlZ29yeSA9PT0gJ2ZlYXR1cmVfcmVx\ndWVzdCcpLmxlbmd0aAogICAgICB9LAogICAgICByZWNlbnRBY3Rpdml0eTog\ndGlja2V0cwogICAgICAgIC5maWx0ZXIodCA9PiBuZXcgRGF0ZSh0LmNyZWF0\nZWRBdCkgPiBsYXN0MzBEYXlzKQogICAgICAgIC5sZW5ndGgsCiAgICAgIGF2\nZXJhZ2VSZXNvbHV0aW9uVGltZTogY2FsY3VsYXRlQXZlcmFnZVJlc29sdXRp\nb25UaW1lKHRpY2tldHMpLAogICAgICB0b3BDdXN0b21lcnM6IGdldFRvcEN1\nc3RvbWVycyh0aWNrZXRzKQogICAgfTsKICAgIAogICAgcmVzLmpzb24oeyBz\ndWNjZXNzOiB0cnVlLCBhbmFseXRpY3MgfSk7CiAgICAKICB9IGNhdGNoIChl\ncnJvcikgewogICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBm\nYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7CiAgfQp9KTsKCi8vIEN1\nc3RvbWVyIHNlbGYtc2VydmljZSBwb3J0YWwKYXBwLmdldCgnL2FwaS9zdXBw\nb3J0L2N1c3RvbWVyLzpjdXN0b21lckVtYWlsL3RpY2tldHMnLCAocmVxLCBy\nZXMpID0+IHsKICB0cnkgewogICAgY29uc3QgY3VzdG9tZXJFbWFpbCA9IHJl\ncS5wYXJhbXMuY3VzdG9tZXJFbWFpbDsKICAgIGNvbnN0IHRpY2tldHMgPSBB\ncnJheS5mcm9tKHN1cHBvcnRUaWNrZXRzLnZhbHVlcygpKQogICAgICAuZmls\ndGVyKHQgPT4gdC5jdXN0b21lckVtYWlsID09PSBjdXN0b21lckVtYWlsKQog\nICAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5jcmVhdGVkQXQpIC0g\nbmV3IERhdGUoYS5jcmVhdGVkQXQpKTsKICAgIAogICAgcmVzLmpzb24oewog\nICAgICBzdWNjZXNzOiB0cnVlLAogICAgICB0aWNrZXRzOiB0aWNrZXRzLm1h\ncCh0ID0+ICh7CiAgICAgICAgaWQ6IHQuaWQsCiAgICAgICAgc3ViamVjdDog\ndC5zdWJqZWN0LAogICAgICAgIHN0YXR1czogdC5zdGF0dXMsCiAgICAgICAg\ncHJpb3JpdHk6IHQucHJpb3JpdHksCiAgICAgICAgY2F0ZWdvcnk6IHQuY2F0\nZWdvcnksCiAgICAgICAgY3JlYXRlZEF0OiB0LmNyZWF0ZWRBdCwKICAgICAg\nICB1cGRhdGVkQXQ6IHQudXBkYXRlZEF0LAogICAgICAgIG1lc3NhZ2VDb3Vu\ndDogdC5tZXNzYWdlcy5sZW5ndGgKICAgICAgfSkpLAogICAgICBjb3VudDog\ndGlja2V0cy5sZW5ndGgKICAgIH0pOwogICAgCiAgfSBjYXRjaCAoZXJyb3Ip\nIHsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgc3VjY2VzczogZmFsc2Us\nIGVycm9yOiBlcnJvci5tZXNzYWdlIH0pOwogIH0KfSk7CgovLyBIZWxwZXIg\nZnVuY3Rpb25zCmZ1bmN0aW9uIGNhbGN1bGF0ZUF2ZXJhZ2VSZXNvbHV0aW9u\nVGltZSh0aWNrZXRzKSB7CiAgY29uc3QgcmVzb2x2ZWRUaWNrZXRzID0gdGlj\na2V0cy5maWx0ZXIodCA9PiB0LnN0YXR1cyA9PT0gJ3Jlc29sdmVkJyB8fCB0\nLnN0YXR1cyA9PT0gJ2Nsb3NlZCcpOwogIGlmIChyZXNvbHZlZFRpY2tldHMu\nbGVuZ3RoID09PSAwKSByZXR1cm4gMDsKICAKICBjb25zdCB0b3RhbFRpbWUg\nPSByZXNvbHZlZFRpY2tldHMucmVkdWNlKChzdW0sIHRpY2tldCkgPT4gewog\nICAgY29uc3QgY3JlYXRlZCA9IG5ldyBEYXRlKHRpY2tldC5jcmVhdGVkQXQp\nOwogICAgY29uc3QgdXBkYXRlZCA9IG5ldyBEYXRlKHRpY2tldC51cGRhdGVk\nQXQpOwogICAgcmV0dXJuIHN1bSArICh1cGRhdGVkIC0gY3JlYXRlZCk7CiAg\nfSwgMCk7CiAgCiAgcmV0dXJuIE1hdGgucm91bmQodG90YWxUaW1lIC8gcmVz\nb2x2ZWRUaWNrZXRzLmxlbmd0aCAvICgxMDAwICogNjAgKiA2MCkpOyAvLyBo\nb3Vycwp9CgpmdW5jdGlvbiBnZXRUb3BDdXN0b21lcnModGlja2V0cykgewog\nIGNvbnN0IGN1c3RvbWVyQ291bnRzID0ge307CiAgdGlja2V0cy5mb3JFYWNo\nKHRpY2tldCA9PiB7CiAgICBjdXN0b21lckNvdW50c1t0aWNrZXQuY3VzdG9t\nZXJFbWFpbF0gPSAoY3VzdG9tZXJDb3VudHNbdGlja2V0LmN1c3RvbWVyRW1h\naWxdIHx8IDApICsgMTsKICB9KTsKICAKICByZXR1cm4gT2JqZWN0LmVudHJp\nZXMoY3VzdG9tZXJDb3VudHMpCiAgICAuc29ydCgoWyxhXSwgWyxiXSkgPT4g\nYiAtIGEpCiAgICAuc2xpY2UoMCwgNSkKICAgIC5tYXAoKFtlbWFpbCwgY291\nbnRdKSA9PiAoeyBlbWFpbCwgdGlja2V0Q291bnQ6IGNvdW50IH0pKTsKfQoK\nLy8gU3RhcnQgc2VydmVyCmFwcC5saXN0ZW4ocG9ydCwgKCkgPT4gewogIGNv\nbnNvbGUubG9nKGBPQXV0aCBiYWNrZW5kIHdpdGggY3VzdG9tZXIgc3VwcG9y\ndCBydW5uaW5nIG9uIHBvcnQgJHtwb3J0fWApOwogIGNvbnNvbGUubG9nKGBW\nZXJzaW9uOiA2LjAuMC1jdXN0b21lci1zdXBwb3J0YCk7CiAgY29uc29sZS5s\nb2coYEZlYXR1cmVzOiBPQXV0aCwgUHJvZHVjdHMsIE1lZGlhIFVwbG9hZCwg\nUHJpY2luZywgQ3VzdG9tZXIgU3VwcG9ydGApOwogIGNvbnNvbGUubG9nKGBJ\nbnN0YWxsYXRpb25zOiAke2luc3RhbGxhdGlvbnMuc2l6ZX1gKTsKICBjb25z\nb2xlLmxvZygnQ3VzdG9tZXIgc3VwcG9ydCBzeXN0ZW06IFJlYWR5Jyk7Cn0p\nOwo=\n",
  "encoding": "base64",
  "_links": {
    "self": "https://api.github.com/repos/EngageAutomations/oauth-backend/contents/index.js?ref=main",
    "git": "https://api.github.com/repos/EngageAutomations/oauth-backend/git/blobs/fe6466940b2e38c3ac8f7b83bf3a1131b3508beb",
    "html": "https://github.com/EngageAutomations/oauth-backend/blob/main/index.js"
  }
}
