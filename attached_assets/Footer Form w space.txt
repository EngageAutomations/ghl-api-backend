<script>
  function getSlugFromUrl() {
    const parts = window.location.pathname.split('/');
    return parts[parts.length - 1] || "unknown";
  }

  function injectCustomForm({ formId = '', height = 470 } = {}) {
    if (!formId || document.querySelector('.description-form-flexwrap')) return;

    const desc = document.getElementById('description');
    if (!desc) return;

    const slug = getSlugFromUrl();
    const embedUrl = `https://app.makerexpress3d.com/widget/form/${formId}?listing=${encodeURIComponent(slug)}&utm_source=directory`;

    // Build the wrapper and preserve layout
    const wrapper = document.createElement('div');
    wrapper.className = 'description-form-flexwrap';
    desc.parentNode.insertBefore(wrapper, desc);
    wrapper.appendChild(desc);

    // Build the iframe
    const iframe = document.createElement('iframe');
    iframe.className = 'inline-listing-form';
    iframe.src = embedUrl;
    iframe.style.height = `${height + 100}px`; // 100px padding if needed
    iframe.style.opacity = '0';
    iframe.style.transition = 'opacity 0.6s ease';
    iframe.style.pointerEvents = 'none';

    iframe.onload = () => {
      iframe.classList.add('visible');
      iframe.style.opacity = '1';
      iframe.style.pointerEvents = 'auto';
    };

    wrapper.appendChild(iframe);
    document.body.classList.add('form-injected');
  }

  // Example usage: this would be filled in dynamically by your parser
  const parsedEmbedData = {
    formId: 'yZsYJQfelidUiq28ij5v', // ⬅ Replace with extracted value
    height: 470                   // ⬅ Replace with extracted height if available
  };

  document.addEventListener("DOMContentLoaded", () => injectCustomForm(parsedEmbedData));
  new MutationObserver(() => injectCustomForm(parsedEmbedData)).observe(document.body, { childList: true, subtree: true });
</script>
