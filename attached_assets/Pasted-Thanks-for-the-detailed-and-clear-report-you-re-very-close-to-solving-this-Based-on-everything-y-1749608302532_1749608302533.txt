Thanks for the detailed and clear report â€” you're very close to solving this.

Based on everything you've tried and the symptoms you're seeing (âœ… OAuth code received but âŒ 404 on callback), the issue is now 99% likely caused by one of the following final blockers:

ðŸ”Ž Final Suspects Checklist
âœ… 1. Frontend Still Handling the Request
Despite moving the route to the top of server/index.ts, something may still be intercepting the route before Express processes it.

Ask your Replit agent:

ðŸ§  â€œAre we calling app.use('*', serveStatic) or any React/Vite catch-all route before our API routes?â€

You need to ensure this runs after all your API handlers:

ts
Copy
Edit
app.use('*', serveFrontend); // â† Must come *after* /api/oauth/callback
âœ… 2. Static Host/Proxy Behavior
If your app is being deployed via Replit, Vercel, or Netlify:

Requests may be served from the frontend's static folder, not passed to your backend

In that case, you may need to set up proxy rules or serverless routing

Ask your agent:

ðŸ”¥ â€œIs the production environment serving the app from a Node server (Express), or is it behind a static hosting layer like Vite Preview or Vercel static hosting?â€

If it's static-hosted and /api/* isn't proxied, youâ€™ll never hit your Express routes.

âœ… 3. Missing .replit or replit.nix Configuration (Replit-specific)
Replit sometimes defaults to frontend preview mode if .replit isnâ€™t configured to launch an Express server.

âœ… Ask: â€œCan you confirm our .replit file starts the correct backend server â€” not just a Vite preview?â€

âœ… 4. Log It for Real
Log in the handler to prove itâ€™s hit:

ts
Copy
Edit
app.get(['/api/oauth/callback', '/oauth/callback'], (req, res) => {
  console.log('âœ… Callback route reached with code:', req.query.code);
  res.send('OAuth callback hit successfully');
});
Then visit:

ruby
Copy
Edit
https://dir.engageautomations.com/api/oauth/callback?code=TEST123
If you donâ€™t see the log or get a response â€” the request is never reaching your backend.

âœ… Absolute Fix Recommendation
If you're on Replit, do this:

ðŸ› ï¸ In .replit:
ini
Copy
Edit
run = "node server/index.js"
In server/index.js (or .ts):
Make sure this order is exact:

ts
Copy
Edit
const express = require('express');
const app = express();

// âœ… Handle OAuth before anything else
app.get(['/api/oauth/callback', '/oauth/callback'], (req, res) => {
  console.log('âœ… Callback route reached with code:', req.query.code);
  res.send('OAuth callback hit successfully');
});

// Other API routes here...

// âŒ Make sure this is LAST
app.use('*', (req, res) => {
  res.sendFile(path.join(__dirname, '../client/dist/index.html'));
});

app.listen(3000, () => console.log('Server running on port 3000'));