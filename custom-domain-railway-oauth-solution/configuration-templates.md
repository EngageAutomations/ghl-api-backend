# Configuration Templates

## Environment Variables

### Railway Backend (.env)
```env
# GoHighLevel OAuth Configuration
GHL_CLIENT_ID=your_ghl_client_id_here
GHL_CLIENT_SECRET=your_ghl_client_secret_here
GHL_REDIRECT_URI=https://your-railway-domain.up.railway.app/api/oauth/callback

# Database (Auto-generated by Railway)
DATABASE_URL=postgresql://postgres:password@hostname:port/database

# Optional: CORS Origins
ALLOWED_ORIGINS=https://your-custom-domain.com,https://your-replit-domain.replit.app

# Environment
NODE_ENV=production
```

### Replit Frontend (.env)
```env
# GoHighLevel Configuration (same as Railway)
GHL_CLIENT_ID=your_ghl_client_id_here
GHL_CLIENT_SECRET=your_ghl_client_secret_here
GHL_REDIRECT_URI=https://your-railway-domain.up.railway.app/api/oauth/callback

# Replit Database
DATABASE_URL=your_replit_postgres_connection_string

# Optional Configuration
NODE_ENV=production
REPLIT_DEPLOYMENT=true
```

## DNS Configuration

### CNAME Record Setup
```
Type: CNAME
Name: your-subdomain (e.g., listings, app, marketplace)
Value: your-replit-deployment-domain.replit.app
TTL: 300 (5 minutes for testing, increase to 3600 for production)
```

### A Record Alternative (if CNAME not supported)
```
Type: A
Name: your-subdomain
Value: [Replit IP address - contact support for current IP]
TTL: 300
```

## Replit Configuration

### replit.toml
```toml
[deployment]
deploymentTarget = "autoscale"
run = ["npx", "tsx", "server/index.ts"]
publicVisible = true

# Route all traffic through Express server
[[deployment.routes]]
source = "/(.*)"
destination = "/$1"
type = "proxy"

[env]
NODE_ENV = "production"
```

### package.json Scripts
```json
{
  "scripts": {
    "dev": "tsx server/index.ts",
    "start": "tsx server/index.ts",
    "build": "vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist"
  }
}
```

## Railway Configuration

### railway.json
```json
{
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "node index.js",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 300
  }
}
```

### package.json (Railway)
```json
{
  "name": "oauth-backend",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "pg": "^8.11.3",
    "drizzle-orm": "^0.29.0",
    "axios": "^1.6.0",
    "dotenv": "^16.3.1"
  }
}
```

## GoHighLevel App Configuration

### OAuth Application Settings
```
Application Name: Your App Name
Application Type: Public
Authorization Callback URL: https://your-railway-domain.up.railway.app/api/oauth/callback
Webhook URL: https://your-railway-domain.up.railway.app/api/webhooks/ghl
Scopes: 
  - contacts.readonly
  - contacts.write
  - locations.readonly
  - locations.write
  - products.readonly
  - products.write
  - media.readonly
  - media.write
```

### Marketplace Listing
```
App Name: Your Marketplace App
Short Description: Professional API integration for GoHighLevel
Long Description: Comprehensive marketplace application providing seamless OAuth integration and universal API access for GoHighLevel operations.
Category: Productivity
Pricing: Free/Paid (as appropriate)
Support URL: https://your-custom-domain.com/support
Privacy Policy: https://your-custom-domain.com/privacy
Terms of Service: https://your-custom-domain.com/terms
```

## Server Configuration Templates

### Production Mode Detection
```javascript
// Environment detection
const nodeEnv = process.env.NODE_ENV || "development";
const isDevelopment = nodeEnv === "development";
const isDeployment = process.env.NODE_ENV === 'production' || process.env.REPLIT_DEPLOYMENT === 'true';
const forceProductionMode = isDeployment;

console.log(`Environment: ${nodeEnv}`);
console.log(`Production mode: ${forceProductionMode}`);
```

### Static File Serving
```javascript
if (forceProductionMode) {
  console.log("Setting up production static serving...");
  
  // Serve static files from dist/public directory
  app.use(express.static(path.join(__dirname, '../dist/public')));
  
  // Catch-all handler: send back index.html file for SPA routing
  app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../dist/public/index.html'));
  });
} else {
  console.log("Setting up development mode with Vite...");
  await setupVite(app, server);
}
```

### Health Check Endpoint
```javascript
app.get('/api/health', (req, res) => {
  res.json({ 
    status: 'healthy', 
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV || 'development',
    domain: req.get('host')
  });
});
```

## Database Schema

### OAuth Installations Table
```sql
CREATE TABLE oauth_installations (
  id SERIAL PRIMARY KEY,
  ghl_user_id VARCHAR(255) UNIQUE NOT NULL,
  ghl_user_email VARCHAR(255),
  ghl_user_name VARCHAR(255),
  ghl_user_phone VARCHAR(255),
  access_token TEXT NOT NULL,
  refresh_token TEXT,
  token_expires_at TIMESTAMP WITH TIME ZONE,
  location_id VARCHAR(255),
  location_name VARCHAR(255),
  installation_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_ghl_user_id ON oauth_installations(ghl_user_id);
CREATE INDEX idx_location_id ON oauth_installations(location_id);
CREATE INDEX idx_access_token ON oauth_installations(access_token);
```

## CORS Configuration

### Permissive CORS for Development
```javascript
const corsOptions = {
  origin: [
    'https://your-custom-domain.com',
    'https://your-replit-domain.replit.app',
    'http://localhost:3000',
    'http://localhost:5000'
  ],
  credentials: true,
  optionsSuccessStatus: 200
};

app.use(cors(corsOptions));
```

### Production CORS
```javascript
const corsOptions = {
  origin: [
    'https://your-custom-domain.com',
    'https://your-replit-domain.replit.app'
  ],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization', 'x-ghl-locationid'],
  optionsSuccessStatus: 200
};

app.use(cors(corsOptions));
```

## SSL/Security Configuration

### Express Security Headers
```javascript
app.use((req, res, next) => {
  res.setHeader('X-Content-Type-Options', 'nosniff');
  res.setHeader('X-Frame-Options', 'DENY');
  res.setHeader('X-XSS-Protection', '1; mode=block');
  res.setHeader('Strict-Transport-Security', 'max-age=31536000; includeSubDomains');
  next();
});
```

### Cookie Configuration for Embedded Access
```javascript
app.use(session({
  secret: process.env.SESSION_SECRET || 'your-session-secret',
  resave: false,
  saveUninitialized: false,
  cookie: {
    secure: process.env.NODE_ENV === 'production',
    httpOnly: true,
    maxAge: 24 * 60 * 60 * 1000, // 24 hours
    sameSite: 'none' // Required for iframe embedding
  }
}));
```

This configuration ensures secure, scalable deployment across all environments.