<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoHighLevel Directory Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .drag-area { border: 2px dashed #cbd5e1; transition: all 0.3s ease; }
        .drag-area.dragover { border-color: #3b82f6; background-color: #eff6ff; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">GoHighLevel Product Creator</h1>
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-6">Create New Product</h2>
                
                <form id="productForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Name</label>
                        <input type="text" id="productName" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter product name" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="productDescription" rows="4" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter product description" required></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price</label>
                        <input type="number" id="productPrice" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter price" min="0" step="0.01" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Type</label>
                        <select id="productType" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="DIGITAL">Digital</option>
                            <option value="PHYSICAL">Physical</option>
                            <option value="SERVICE">Service</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Product Images</label>
                        <div id="imageUploadArea" class="drag-area border-2 border-dashed border-gray-300 rounded-md p-6 text-center cursor-pointer">
                            <div id="uploadPrompt">
                                <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <p class="text-gray-600">Click to upload images or drag and drop</p>
                                <p class="text-sm text-gray-500 mt-2">PNG, JPG, GIF up to 10MB each</p>
                            </div>
                            <div id="imagePreview" class="hidden grid grid-cols-2 md:grid-cols-3 gap-4 mt-4"></div>
                        </div>
                        <input type="file" id="imageInput" multiple accept="image/*" class="hidden">
                    </div>
                    
                    <div id="statusArea" class="hidden p-4 rounded-md"></div>
                    
                    <button type="submit" id="submitBtn" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 font-medium">
                        Create Product in GoHighLevel
                    </button>
                </form>
            </div>
            
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">Recent Activity</h3>
                <div id="activityLog" class="space-y-2">
                    <p class="text-gray-500 text-sm">No recent activity</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedImages = [];
        
        // Form elements
        const form = document.getElementById('productForm');
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const uploadPrompt = document.getElementById('uploadPrompt');
        const statusArea = document.getElementById('statusArea');
        const activityLog = document.getElementById('activityLog');
        
        // Image upload functionality
        imageUploadArea.addEventListener('click', () => imageInput.click());
        
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });
        
        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });
        
        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        imageInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });
        
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadImageToRailway(file);
                }
            });
        }
        
        async function uploadImageToRailway(file) {
            showStatus('Uploading image to GoHighLevel media library...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('installationId', 'install_1750252333303');
                
                const response = await fetch('https://dir.engageautomations.com/api/ghl/media/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    uploadedImages.push({
                        url: result.url,
                        mediaId: result.mediaId,
                        filename: file.name
                    });
                    
                    displayImagePreview(result.url, file.name);
                    showStatus(`Image uploaded successfully: ${file.name}`, 'success');
                    logActivity(`Uploaded image: ${file.name}`);
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                showStatus(`Failed to upload ${file.name}: ${error.message}`, 'error');
            }
        }
        
        function displayImagePreview(url, filename) {
            uploadPrompt.classList.add('hidden');
            imagePreview.classList.remove('hidden');
            
            const imgContainer = document.createElement('div');
            imgContainer.className = 'relative group';
            imgContainer.innerHTML = `
                <img src="${url}" alt="${filename}" class="w-full h-24 object-cover rounded-md">
                <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-md flex items-center justify-center">
                    <span class="text-white text-xs">${filename}</span>
                </div>
            `;
            
            imagePreview.appendChild(imgContainer);
        }
        
        function showStatus(message, type) {
            statusArea.classList.remove('hidden');
            statusArea.className = `p-4 rounded-md ${
                type === 'success' ? 'bg-green-100 text-green-800' :
                type === 'error' ? 'bg-red-100 text-red-800' :
                'bg-blue-100 text-blue-800'
            }`;
            statusArea.textContent = message;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => statusArea.classList.add('hidden'), 5000);
            }
        }
        
        function logActivity(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'text-sm text-gray-600';
            logEntry.textContent = `${timestamp}: ${message}`;
            
            if (activityLog.children[0]?.textContent === 'No recent activity') {
                activityLog.innerHTML = '';
            }
            
            activityLog.insertBefore(logEntry, activityLog.firstChild);
        }
        
        // Form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Product...';
            
            showStatus('Creating product in GoHighLevel...', 'info');
            
            try {
                const productData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDescription').value,
                    productType: document.getElementById('productType').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    images: uploadedImages
                };
                
                const response = await fetch('https://dir.engageautomations.com/api/ghl/products/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        installationId: 'install_1750252333303',
                        productData: productData
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showStatus(`Product created successfully! Product ID: ${result.product?.id}`, 'success');
                    logActivity(`Created product: ${productData.name}`);
                    
                    // Reset form
                    form.reset();
                    uploadedImages = [];
                    imagePreview.innerHTML = '';
                    imagePreview.classList.add('hidden');
                    uploadPrompt.classList.remove('hidden');
                    
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Failed to create product');
                }
                
            } catch (error) {
                showStatus(`Failed to create product: ${error.message}`, 'error');
                logActivity(`Error: ${error.message}`);
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create Product in GoHighLevel';
        });
        
        // Initial activity log
        logActivity('Product creator ready');
    </script>
</body>
</html>