<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoHighLevel OAuth Test - Product Creation</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .oauth-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .code-block { background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>GoHighLevel OAuth Product Creation Test</h1>
    
    <div class="oauth-section success">
        <h3>OAuth Credentials Configured</h3>
        <p><strong>CLIENT_ID:</strong> 68474924a586bce22a6e64f7-mbpkmyu4</p>
        <p><strong>CLIENT_SECRET:</strong> Configured ✓</p>
        <p><strong>Redirect URI:</strong> https://listings.engageautomations.com/oauth/callback</p>
    </div>

    <div class="oauth-section">
        <h3>Step 1: Authorize Application</h3>
        <p>Click the button below to authorize the app with GoHighLevel:</p>
        <button onclick="startOAuth()">Authorize with GoHighLevel</button>
        <div class="code-block" id="oauth-url" style="margin-top: 10px; display: none;"></div>
    </div>

    <div class="oauth-section warning">
        <h3>Step 2: OAuth Callback</h3>
        <p>After authorization, you'll be redirected to:</p>
        <div class="code-block">https://listings.engageautomations.com/oauth/callback?code=AUTH_CODE&location_id=LOCATION_ID</div>
        <p>Our server will:</p>
        <ul>
            <li>Exchange authorization code for access token</li>
            <li>Store token with location mapping</li>
            <li>Generate JWT for frontend authentication</li>
            <li>Enable product creation API calls</li>
        </ul>
    </div>

    <div class="oauth-section">
        <h3>Step 3: Test Product Creation</h3>
        <p>Once OAuth is complete, test product creation:</p>
        <button onclick="testProductCreation()">Create Test Product</button>
        <div id="product-result" style="margin-top: 10px;"></div>
    </div>

    <div class="oauth-section">
        <h3>Product Details</h3>
        <div class="code-block">
{
  "name": "AI Robot Assistant Pro - Replit Edition",
  "description": "Advanced AI automation assistant created through Replit OAuth integration",
  "price": 497.00,
  "locationId": "WAVk87RmW9rBSDJHeOpH",
  "productType": "DIGITAL",
  "availability": "PUBLIC"
}
        </div>
    </div>

    <script>
        function startOAuth() {
            const clientId = '68474924a586bce22a6e64f7-mbpkmyu4';
            const redirectUri = 'https://listings.engageautomations.com/oauth/callback';
            const scopes = 'products.write products.readonly medias.write medias.readonly locations.readonly';
            
            const authUrl = `https://marketplace.leadconnectorhq.com/oauth/chooselocation?` +
                `response_type=code&` +
                `client_id=${clientId}&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `scope=${encodeURIComponent(scopes)}`;
            
            document.getElementById('oauth-url').innerHTML = authUrl;
            document.getElementById('oauth-url').style.display = 'block';
            
            // Open OAuth flow in new window
            window.open(authUrl, 'oauth', 'width=600,height=700');
        }

        async function testProductCreation() {
            const resultDiv = document.getElementById('product-result');
            resultDiv.innerHTML = 'Testing product creation...';
            
            try {
                const response = await fetch('/api/ghl/locations/WAVk87RmW9rBSDJHeOpH/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: 'AI Robot Assistant Pro - Replit Edition',
                        description: 'Advanced AI automation assistant created through Replit OAuth integration',
                        price: 497.00,
                        locationId: 'WAVk87RmW9rBSDJHeOpH',
                        productType: 'DIGITAL',
                        availability: 'PUBLIC'
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">✓ Product created successfully! ID: ${result.product?.id}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">Error: ${result.error || 'Authentication required'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Request failed: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>