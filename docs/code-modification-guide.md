# Code Modification Guide

This guide explains which files to edit when you need to modify the generated CSS, Header, or Footer code in the slideshow wizard.

## Overview

The slideshow wizard generates three types of code dynamically based on user settings:
- **CSS Code**: Styling and element hiding rules
- **Header Code**: JavaScript functionality and initialization
- **Footer Code**: Form integration and event handling

## Files to Edit

### CSS Code Generation
**File**: `client/src/pages/ConfigWizardSlideshow.tsx`
**Lines**: ~977-1123 (Copy button onClick) and ~1143-1226 (Display template)

**What to modify**:
- CSS selectors and rules
- Element hiding logic
- Styling overrides
- Layout fixes

**Example modifications**:
```javascript
// To add new hiding rules
${showNewElement === false ? `
/* Hide New Element */
body:not(.hl-builder) .new-element-class {
  display: none !important;
}` : ''}

// To modify existing selectors
body:not(.hl-builder) [class*="product-title"],
body:not(.hl-builder) .your-custom-selector {
  // your styles here
}
```

### Header Code Generation
**File**: Generated by proven code generation functions (imported from lib folder)
**Primary Location**: `client/src/pages/ConfigWizardSlideshow.tsx` line ~1256

**Dependencies**:
- `@/lib/embed-parser.ts` - Form parsing logic
- `@/lib/custom-popup-generator.ts` - Popup functionality
- `@/lib/embedded-form-generator.ts` - Form integration

**What to modify**:
- JavaScript initialization code
- Event listeners
- Form parsing logic
- API endpoints

### Footer Code Generation
**File**: Same as Header Code - generated by lib functions
**Primary Location**: `client/src/pages/ConfigWizardSlideshow.tsx` line ~1302

**What to modify**:
- Form submission handling
- Button event listeners
- Dynamic content injection
- Analytics tracking

## Key State Variables

These variables control code generation and can be modified:

```javascript
// Feature toggles (lines 57-64)
const [showPrice, setShowPrice] = useState<boolean>(false);
const [showBuyNowButton, setShowBuyNowButton] = useState<boolean>(false);
const [showAddToCartButton, setShowAddToCartButton] = useState<boolean>(false);
const [showQuantitySelector, setShowQuantitySelector] = useState<boolean>(false);
const [showCartIcon, setShowCartIcon] = useState<boolean>(false);
const [showDescription, setShowDescription] = useState<boolean>(false);
const [showMetadata, setShowMetadata] = useState<boolean>(false);
const [showMaps, setShowMaps] = useState<boolean>(false);

// Form configuration (lines 44-50)
const [buttonType, setButtonType] = useState<string>('embed');
const [formEmbedUrl, setFormEmbedUrl] = useState<string>('');
const [customFieldName, setCustomFieldName] = useState<string>('listing');
const [previewColor, setPreviewColor] = useState<string>('#3b82f6');
const [previewTextColor, setPreviewTextColor] = useState<string>('#ffffff');
const [previewBorderRadius, setPreviewBorderRadius] = useState<number>(8);
```

## Common Modifications

### Adding New Feature Toggle
1. Add state variable in ConfigWizardSlideshow.tsx
2. Add toggle UI in Features section (around line 862)
3. Add CSS generation logic in both copy and display sections
4. Update lib generation functions if needed

### Modifying CSS Selectors
1. Edit the CSS template strings in ConfigWizardSlideshow.tsx
2. Update both the copy button onClick and display template
3. Test with actual GoHighLevel pages

### Changing Default Values
1. Modify useState initial values (lines 57-64)
2. Update any hardcoded defaults in generation templates

### Adding New Integration Method
1. Add option to buttonType state management
2. Update integration method buttons (around line 518)
3. Add generation logic in lib functions
4. Update header/footer code generation

## Code Generation Flow

1. User changes settings in slideshow
2. State variables update
3. Code generation templates use state to build output
4. Templates combine static code with dynamic conditionals
5. Copy buttons and display areas show final generated code

## Testing Changes

After modifying code generation:

1. Test with all toggle combinations
2. Verify CSS works on actual GoHighLevel pages
3. Check header/footer integration functionality
4. Validate form submission handling
5. Test copy/paste workflow

## File Structure

```
client/src/pages/
  ConfigWizardSlideshow.tsx     # Main slideshow with code generation

client/src/lib/
  embed-parser.ts               # Form parsing utilities
  custom-popup-generator.ts     # Popup code generation
  embedded-form-generator.ts    # Form integration code
  expanded-description-generator.ts  # Description features
  metadata-bar-generator.ts     # Metadata functionality
```

## Developer Code Modification Process

### Step-by-Step Fix Workflow

1. **Identify the Issue**
   - Determine if it's CSS, Header, or Footer code
   - Check if it's a generation logic or template issue
   - Verify if it affects all users or specific configurations

2. **Locate the Correct File**
   - CSS issues: `ConfigWizardSlideshow.tsx` lines 977-1226
   - Header/Footer issues: Check lib functions first, then slideshow
   - New features: May require multiple file changes

3. **Make the Changes**
   ```javascript
   // Example: Fix CSS selector specificity
   // OLD:
   body:not(.hl-builder) .product-title {
     display: none !important;
   }
   
   // NEW:
   body:not(.hl-builder) .product-title,
   body:not(.hl-builder) .hl-product-title,
   body:not(.hl-builder) [data-product="title"] {
     display: none !important;
   }
   ```

4. **Update Both Code Locations**
   - Copy button onClick function (around line 977)
   - Display template string (around line 1143)
   - Both must generate identical output

5. **Test the Fix**
   - Toggle all feature combinations
   - Copy generated code and test on live GoHighLevel page
   - Verify functionality works as expected

### Common Fix Scenarios

#### Fixing CSS Selector Issues
**Problem**: CSS not targeting the right elements
**Solution**: Update selectors in both locations

```javascript
// In ConfigWizardSlideshow.tsx, find this pattern and update:
body:not(.hl-builder) [class*="old-selector"],
body:not(.hl-builder) .new-selector,
body:not(.hl-builder) [data-attribute="value"] {
  display: none !important;
}
```

#### Adding Missing Feature Support
**Problem**: Need to hide/show new GoHighLevel elements
**Steps**:
1. Add state variable: `const [showNewFeature, setShowNewFeature] = useState(false);`
2. Add toggle UI in Features section
3. Add CSS generation logic:
```javascript
${showNewFeature === false ? `
/* Hide New Feature */
body:not(.hl-builder) .new-feature-selector {
  display: none !important;
}` : ''}
```

#### Fixing Form Integration Issues
**Problem**: Header/Footer code not working properly
**Files to check**:
- `lib/custom-popup-generator.ts`
- `lib/embedded-form-generator.ts`
- `lib/embed-parser.ts`

**Process**:
1. Identify which lib function generates problematic code
2. Update the generation logic in that file
3. Test with different buttonType configurations

#### Updating Default Behavior
**Problem**: Wrong default settings for new users
**Solution**: Modify useState initial values

```javascript
// Change defaults in ConfigWizardSlideshow.tsx
const [showBuyNowButton, setShowBuyNowButton] = useState<boolean>(true); // was false
```

### Debugging Generated Code

1. **Console Logging**
   ```javascript
   // Add temporary logging to see generated output
   console.log('Generated CSS:', cssCode);
   console.log('Current toggles:', { showBuyNowButton, showAddToCartButton });
   ```

2. **Live Testing**
   - Copy generated code
   - Paste into GoHighLevel Custom CSS section
   - Check browser developer tools for conflicts

3. **Validation**
   - Ensure CSS syntax is valid
   - Verify JavaScript doesn't have errors
   - Test form submission functionality

### Version Control Best Practices

1. **Commit Strategy**
   ```bash
   git add client/src/pages/ConfigWizardSlideshow.tsx
   git commit -m "fix: Update CSS selectors for product title hiding"
   ```

2. **Testing Checklist**
   - [ ] All toggle combinations work
   - [ ] Generated code is syntactically valid
   - [ ] Copy buttons produce correct output
   - [ ] Display templates match copy output
   - [ ] Live GoHighLevel integration works

3. **Documentation Updates**
   - Update this guide when adding new features
   - Document any breaking changes
   - Include examples of new functionality

## Best Practices

1. **Test thoroughly** - Code changes affect live GoHighLevel integrations
2. **Maintain backwards compatibility** - Existing generated code should continue working
3. **Update both locations** - Copy button and display template must match
4. **Document changes** - Update this guide when adding new features
5. **Use semantic versioning** - Track code generation changes
6. **Validate output** - Always test generated code on actual GoHighLevel pages
7. **Consider edge cases** - Test with different button types and toggle combinations